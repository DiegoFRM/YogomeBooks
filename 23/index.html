<!doctype html>
<html>
<head>
<title class="languageTitle">Gracias</title>
 <meta charset="UTF-8">    
<meta name="viewport" content="width = 1050, user-scalable = no" />
<link rel="icon" type="image/png" href="../../pics/favicon.png" />
<script type="text/javascript" src="extras/jquery.min.1.7.js"></script>
<script type="text/javascript" src="extras/jquery-ui-1.8.20.custom.min.js"></script>
<script type="text/javascript" src="extras/modernizr.2.5.3.min.js"></script>
<script type="text/javascript" src="lib/hash.js"></script>
<script type="text/javascript" src="js/jquery.blast.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js"></script>
    <script type="text/javascript" src="js/tracks.js"></script>
<script type="text/javascript" src="js/audioSync.js"></script> 
    <!--ESta de manera absoluta la direccion de epic model, por la profundidad que tiene dentro del server-->
<script type="text/javascript" src="http://play.yogome.com/js/epic/models/epicModel.js"></script>    
<script type="text/javascript" src="../../js/mixpanel/mixpanel.js"></script>           
<script>
    var languageTitles = [
            {
                ES:"Gracias",
                EN:"Thank You",
                PT:"Obrigado",
                ZH:"谢谢",
                JA:"ありがとう",
                KO:"고마워"
            }
        ]
    
    //AQUI VA PARA SABER EL LENGUAGE
        function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}

        var language;
        language = getParameterByName("language");
    
     function changeTitle(){
        if(language == "ES"){
            $(".languageTitle").text(languageTitles[0][language])
        }else if(language == "EN"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else if(language == "PT"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else if(language == "ZH"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else if(language == "JA"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else if(language == "KO"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else{
            $(".languageTitle").text(languageTitles[0].EN)    
        }
    }    
    
    changeTitle()
    
var languagePages = [
                {
                    page:1,
                    ES:"Después de la gran batalla todos fueron a celebrar a la sala de juegos de las Yogomansión.</br></br>-¡Esperen amigos! -dijo Eagle.</br></br>Todos se comportaron extraños con él.",
                    EN:"After a huge battle, everybody celebrated at the Yogmansion playroom. &#34;Guys, wait!&#34; said Eagle. Everybody was acting strange.",
                    PT:"Depois de uma grande batalha, todos comemoraram na sala de jogos da Yogomansão. “Amigos, esperem!”, disse Eagle. Todo mundo estava agindo de modo estranho.",
                    ZH:"经过一场激战，每个人都在Yogmansion游戏室庆祝。“伙计们，等等！”伊戈说。每个人都表现得很奇怪。",
                    JA:"おおきなたたかいのあと、みんなはヨゴマンションのプレイルームでおいわいしました。「みんな、まって！」イーグルが言いました。みんなはようすがへんでした。",
                    KO:"큰 전투가 끝난 뒤, 모두 요고맨션 놀이방에 모여서 승리를 축하하고 있었어요. &#34;얘들아, 잠깐만!&#34; 이글이가 말했어요. 모두 이상하게 행동하고 있었어요."
                },
                {
                    page:2,
                    ES:"Eagle le pidió un vaso de agua de frutas a Dinamita, pero él parecía no escucharlo.",
                    EN:"Eagle asked Dinamita for a glass of juice, but he pretended not to hear.",
                    PT:'Eagle pediu um copo de suco para Dinamita, mas ele fingiu que não ouviu.',
                    ZH:"伊戈向迪纳米特要了一杯果汁，但他假装没听见。",
                    JA:"イーグルはディナミタにジュースをたのみましたが、ディナミタは聞こえないふりをしました。",
                    KO:"이글이는 다이나미타에게 주스를 한 잔 달라고 했지만, 다이나미타는 못 들은 척 했어요."
                },
                {
                    page:3,
                    ES:"Eagle intentó platicar con Oof sobre la batalla pero él se dio media vuelta, parecía molesto.",
                    EN:"Eagle tried to talk to Oof about the battle, but he just turned away. Oof seemed to be mad.",
                    PT:"Eagle tentou falar com Oof sobre a batalha, mas ele virou as costas e foi embora. Oof parecia bem chateado.",
                    JA:"イーグルはウーフにはなしかけようとしましたが、そっぽをむいてしまいました。ウーフはおこっているようです。",
                    ZH:"伊戈想和奥夫谈谈这场战斗，但他却转身离开了。奥夫似乎疯了。",
                    KO:"이글이는 우프에게 전투에 대해서 얘기하려고 했지만, 우프는 그저 돌아서 가버렸어요. 우프는 화나 보였어요."
                },
                {
                    page:4,
                    ES:"Eagle desesperado, y algo afligido, caminó hacia Luna y le preguntó:</br></br>-¿Qué está pasando Luna? Nadie me hace caso, simplemente me ignoran. ¿Qué me hicieron los extraterrestres en la batalla?</br></br>-No pasa nada Eagle, eres tú; el equipo está enojado contigo porque no pides las cosas “por favor”.",
                    EN:"Eagle, desperate and a little sad walked to Luna and asked her: &#34;What's going on, Luna? Nobody pays attention to me, they just ignore me. What did the aliens do to me during the battle?&#34; &#34;There's nothing going on Eagle, it's you. The team is mad at you because you never say please.&#34;",
                    PT:"Eagle, desesperado e um pouco triste, foi até Luna e perguntou: “O que está acontecendo, Luna? Ninguém me dá atenção; eles ficam me ignorando. O que os alienígenas fizeram comigo durante a batalha?” “Não tem nada acontecendo, Eagle, o problema é você. A equipe está brava porque você nunca fala ‘por favor’.”",
                    ZH:"伊戈绝望还有点悲伤地走到鲁娜跟前，问她:“怎么回事，鲁娜？大家都不理睬我，他们对我视而不见。外星人在战斗中对我做了什么？”“没什么，伊戈，是你自己。大家生你的气，是因为你从不说请字。”",
                    JA:"イーグルはかなしくなって、ルナのところへ行き、たずねました。「ルナ、いったいどうしたんだい？だれもぼくのことをみてくれない、むしするんだ。たたかいのあいだに、エイリアンがぼくに何かしたのかな？」「何もしていないわよ、イーグルあなたじしんがもんだいよ。チームのみんなはイーグルがいちどもおねがいと言わないからおこっているのよ。」",
                    KO:"이글이는 절망적이고 슬픈 마음으로 루나에게 다가가 물었어요. &#34;루나야, 무슨 일이 일어나고 있는 거야? 아무도 내 말을 듣지 않아. 모두들 나를 무시하고 있어. 전투 중에 외계인들이 나에게 무슨 짓을 한 거니?&#34; &#34;아무 일도 일어나지 않았어. 문제는 너야. 네가 '부탁해'라는 말을 절대 하지 않아서 친구들이 너에게 화가 난 거야.&#34;"
                },
                {
                    page:5,
                    ES:"Eagle volvió hacia Dinamita y otra vez le pidió un vaso de agua de frutas.</br></br>-Dinamita ¿Puedes regalarme agua? Por favor.</br></br>Todos los Yogotars voltearon hacia Eagle al escuchar “por favor”.</br></br>Oof por su parte inició una plática con él, como si nada hubiera pasado.",
                    EN:"Eagle came back to Dinamita and asked him for a glass of juice again. &#34;Can you please give me some juice, Dinamita?&#34; All of the Yogotars turned to look at Eagle when they heard the word &#34;please&#34;. Oof then started talking to Eagle as if nothing had happened.",
                    PT:'Eagle voltou a Dinamita e pediu um copo de suco de novo. “Por favor, você pode me dar um pouco de suco, Dinamita?” Todos os Yogotars se viraram para Eagle quando ouviram a palavra “por favor”. Oof começou a falar com Eagle como se nada tivesse acontecido.',
                    ZH:"伊戈回来找到迪纳米特，又向他要了一杯果汁。“迪纳米特，请给我一些果汁，好吗？”当所有Yogotar听到“请”这个字时，都转头看着伊戈。奥夫开始和伊戈说话，好像什么也没发生过。",
                    JA:"イーグルはディナミタのところへもどって、もういちどジュースをたのみました。「ディナミタジュースをおねがいしてもいいかな？「おねがい」ということばが聞こえるとヨゴターのみんなはふりかえってイーグルを見ました。ウーフはまるで何もなかったように、イーグルにはなしかけはじめました。",
                    KO:"이글이는 다이나미타에게 돌아가서 다시 한번 주스를 달라고 물었어요. &#34;다이나미타야, 나에게 주스 한 잔을 줄래? 부탁해.&#34; 이글이가 '부탁해'라고 하는 말을 들었을 때, 모든 요고타들이 고개를 돌려서 그를 쳐다봤어요. 우프는 아무 일도 일어나지 않았던 것처럼 다시 이글이와 대화를 나누었어요."
                },
                {
                    page:6,
                    ES:"-Gracias Luna -dijo Eagle.</br></br>-De nada -respondió Luna-. Todos aquí nos esforzamos por convivir en paz, es importante dirigirse correctamente hacia los demás. Aunque nos conocemos desde hace mucho tiempo siempre debe haber respeto entre nosotros “por favor” y “gracias” son palabras sencillas que pueden cambiar todo.",
                    EN:"&#34;Thank you, Luna!&#34; Said Eagle. &#34;You're welcome&#34; she answered. &#34;We all try to get along, so it's important to treat everyone nicely. Although we've known each other for a long time, we must always be respectful. Please and thank you are simple words that can make your friends feel like you care about them.&#34; ",
                    PT:"“Obrigado, Luna!”, disse Eagle. “De nada”, respondeu ela. “Todos nós queremos nos dar bem, então é importante tratarmos bem uns aos outros. Embora a gente se conheça há bastante tempo, devemos sempre tratar os outros com respeito. “Por favor” e “obrigado” são palavras simples que fazem os amigos sentirem que você se importa com eles.”",
                    ZH:"“谢谢你，鲁娜！”伊戈说。“不客气，”她回答。“我们努力和睦相处，所以善待每个人是很重要的。虽然我们认识很久了，但我们也必须始终尊重对方。虽然请和谢谢只是简单的几个字，但可以让你的朋友觉得你关心他们。”",
                    JA:"「ありがとう、ルナ！」イーグルは言いました。「どういたしまして」ルナがこたえました。「みんななかよくやっていかなくちゃ。だからおたがいにやさしくすることがだいじなの。わたしたちはながいあいだいっしょにいるけれど、いつもれいぎをわすれてはだめ。おねがいやありがとうはかんたんなことば。でもともだちのことを気にかけているということがわかることばなのよ。」",
                    KO:"&#34;고마워 루나야.&#34; 이글이가 말했어요. &#34;천만에.&#34; 루나가 대답했어요. &#34;우리는 모두 친하게 지내려고 노력하고 있어. 그래서 모두를 잘 대하는 게 중요해. 우리가 오랜 시간 동안 친구였지만, 그래도 우리는 항상 서로를 존중해 줘야 해. 네가 '부탁해' 나 '고마워' 같은 단순한 말만 더해도 네 친구들은 네가 자기들을 어마나 아끼고 배려하는지 느낄 수 있어.&#34;"
                }
                ]    
    </script>   
</head>
<body>

<div id="canvas">


<div class="magazine-viewport">
	<div class="container">
        
		<div class="magazine">
            <div id="p1" depth="5" class="hard"> <div class="side"></div> </div>
			<div depth="5" class="hard front-side"> <div class="depth"></div> </div>
			<div class="hard fixed back-side p17"></div>
			<div class="hard p18"></div>

            </div>
            <script>
                //console.log(languagePages[0][language]);
                if(language == "ES"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1ES.png')");
                }else if(language == "EN"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1EN.png')");
                }else if(language == "ZH"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1ZH.png')");
                }else if(language == "KO"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1KO.png')");
                }else if(language == "JA"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1JA.png')");
                }else if(language == "PT"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1PT.png')");
                }else{
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1EN.png')");
                }
            
            </script>
        
        
			<!-- Next button -->
		</div>
	</div>
   <a onclick="goBack()"><div id="homeButton"><img src="images/homeButton.png" /></div></a>

<script>
function goBack() {
    window.location.href="../../yogobooks.html";
}
</script>
    <div class="languageButton"><img src="images/icon-languages.png"></div>
    <div class="idiomas">
        <div id="ButtonLanEs" class="overLanguage">Español</div>
        <div id="ButtonLanEn" class="overLanguage">English</div>
        <div id="ButtonLanZh" class="overLanguage">中國</div>
        <div id="ButtonLanJa" class="overLanguage">日本語</div>
        <div id="ButtonLanKo" class="overLanguage">한국어</div>
        <div id="ButtonLanPt" class="overLanguage">PORTUGUES</div>
    </div>
    <div id="audiosGroup"></div>
	<div class="bottom">
        <div ignore="1" class="next-button">
            <div id="activeNext">
                <img src="images/nextButtonActive.png">
            </div>
            <img src="images/nextButton.png">
            </div>
			<!-- Previous button -->
			<div ignore="1" class="previous-button">
    <img src="images/prevButton.png">
            </div>        
		<div id="slider-bar" class="turnjs-slider timeline-style">
			<div id="slider">
            </div>
		</div>
         <div id="sectionPlayButton" ><img id="buttonPlay" src="images/Play.png"></div>
	</div>
    
</div>

<script type="text/javascript">
    //$("#sectionPlayButton").hide();
    var audioNumber;
    var clearTimeOut;
    var audioReady;
    var playing = false;
    var audioPlayer; 
    //cambio de regex
    function replaceQueryParam(param, newval, search) {
        var regex = new RegExp("([?;&])" + param + "[^&;]*[;&]?");
        var query = search.replace(regex, "$1").replace(/&$/, '');

        return (query.length > 2 ? query + "&" : "?") + (newval ? param + "=" + newval : '');
    }    
    
    
    $("#ButtonLanEs").click(function(){

        var str = window.location.search
        str = replaceQueryParam('language', "ES", str)
        window.location = window.location.pathname + str + "#page/" + audioNumber;
    });
    
    $("#ButtonLanEn").click(function(){

        var str = window.location.search
        str = replaceQueryParam('language', "EN", str)
        window.location = window.location.pathname + str + "#page/" + audioNumber;
    });
    
    $("#ButtonLanZh").click(function(){

        var str = window.location.search
        str = replaceQueryParam('language', "ZH", str)
        window.location = window.location.pathname + str + "#page/" + audioNumber;
    });
    
    $("#ButtonLanJa").click(function(){

        var str = window.location.search
        str = replaceQueryParam('language', "JA", str)
        window.location = window.location.pathname + str + "#page/" + audioNumber;
    });
    
    $("#ButtonLanKo").click(function(){

        var str = window.location.search
        str = replaceQueryParam('language', "KO", str)
        window.location = window.location.pathname + str + "#page/" + audioNumber;
    });
    
    $("#ButtonLanPt").click(function(){

        var str = window.location.search
        str = replaceQueryParam('language', "PT", str)
        window.location = window.location.pathname + str + "#page/" + audioNumber;
    });
    
    $(".languageButton").click(function(){
        var idioma = $(".idiomas");
        if (idioma.css("display") === "block") {
            idioma.css("display","none");
        } else {
            idioma.css("display","block");
        }
    
        
    });
    
    TweenMax.fromTo($("#activeNext"),1,{alpha:0.5},{alpha:1,yoyo:true,repeat:-1});
    
    $("#audiosGroup").append('<audio id="audio0" preload="true" src="audios/' +  0 + '.mp3"></audio>') 
    for(var i = 1;i<=6;i++){
       $("#audiosGroup").append('<audio id="audio'+i+'" preload="true" src="audios/' +[language] + "/" +  i + '.mp3"></audio>')  
    }
    

function loadApp() {

 	$('#canvas').fadeIn(1000);

 	var flipbook = $('.magazine');

 	// Check if the CSS was already loaded
	
	if (flipbook.width()==0 || flipbook.height()==0) {
		setTimeout(loadApp, 10);
		return;
	}
	
	// Create the flipbook

	flipbook.turn({
			
			// Magazine width

			width: 922,

			// Magazine height

			height: 600,

			// Duration in millisecond

			duration: 1000,

			// Enables gradients

			gradients: true,
			
			// Auto center this flipbook

			autoCenter: true,

			// Elevation from the edge of the flipbook when turning a page

			elevation: 50,

			// The number of pages

			pages: 18,

			// Events

			when: {
                
                
                
				turning: function(event, page, view) {
					
					var book = $(this),
					currentPage = book.turn('page'),
					pages = book.turn('pages');
                    
		

				updateDepth(book, page);
				
				if (page>=2)
					$('.magazine .p2').addClass('fixed');
				else
					$('.magazine .p2').removeClass('fixed');

				if (page<book.turn('pages'))
					$('.magazine .p17').addClass('fixed');
				else
					$('.magazine .p17').removeClass('fixed');
                    
                    if(language == "ES"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2ES.png')");
                }else if(language == "EN"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2EN.png')");
                }else if(language == "ZH"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2ZH.png')");
                }else if(language == "KO"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2KO.png')");
                }else if(language == "JA"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2JA.png')");
                }else if(language == "PT"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2PT.png')");
                }else{
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2EN.png')");
                }


					Hash.go('page/' + page).update();

					// Show and hide navigation buttons
                    audioNumber = page;
					disableControls(page);

				},
                
				turned: function(event, page, view) {

					disableControls(page);
                    var object = $(this);

					$(this).turn('center');
                   

					$('#slider').slider('value', getViewNumber(object, page));
                    audioNumber = page;
            
					if (page==1) { 
						$(this).turn('peel', 'br');
					}

				},

				missing: function (event, pages) {

					// Add pages that aren't in the magazine

					for (var i = 0; i < pages.length; i++)
						addPage(pages[i], $(this));

				}
			}

        
	});

	// Zoom.js

    
    
	$('.magazine-viewport').zoom({
		flipbook: $('.magazine'),

		max: function() { 
			
			return largeMagazineWidth()/$('.magazine').width();

		}, 

		when: {
			swipeLeft: function() {

				$(this).zoom('flipbook').turn('next');
                
                stopAllSounds();

			},

			swipeRight: function() {
				
				$(this).zoom('flipbook').turn('previous');
                stopAllSounds();

			},

			resize: function(event, scale, page, pageElement) {

//				if (scale==1)
//					loadSmallPage(page, pageElement);
//				else
//					loadLargePage(page, pageElement);

			},

			zoomIn: function () {
                
                $(".userName").addClass("zoomUserName")
				$('#slider-bar').hide();
				$('.made').hide();
				$('.magazine').removeClass('animated').addClass('zoom-in');
				$('.zoom-icon').removeClass('zoom-icon-in').addClass('zoom-icon-out');
				
				if (!window.escTip && !$.isTouch) {
					escTip = true;

					$('<div />', {'class': 'exit-message'}).
						html('<div>Press ESC to exit</div>').
							appendTo($('body')).
							delay(2000).
							animate({opacity:0}, 500, function() {
								$(this).remove();
							});
				}
			},

			zoomOut: function () {
                
                $(".userName").removeClass("zoomUserName")
				$('#slider-bar').fadeIn();
				$('.exit-message').hide();
				$('.made').fadeIn();
				$('.zoom-icon').removeClass('zoom-icon-out').addClass('zoom-icon-in');

				setTimeout(function(){
					$('.magazine').addClass('animated').removeClass('zoom-in');
					resizeViewport();
				}, 0);

			}
		}
	});



	// Using arrow keys to turn the page

	$(document).keydown(function(e){

		var previous = 37, next = 39, esc = 27;

		switch (e.keyCode) {
			case previous:

				// left arrow
				$('.magazine').turn('previous');
                stopAllSounds();
                
				e.preventDefault();

			break;
			case next:

				//right arrow
				$('.magazine').turn('next');
                stopAllSounds();
				e.preventDefault();

			break;
			case esc:
				
				$('.magazine-viewport').zoom('zoomOut');	
				e.preventDefault();

			break;
		}
	});

	// URIs - Format #/page/1 

    
    
	Hash.on('^page\/([0-9]*)$', {
		yep: function(path, parts) {
			var page = parts[1];

			if (page!==undefined) {
				if ($('.magazine').turn('is'))
					$('.magazine').turn('page', page);
                audioReady = page;
                
			}

		},
		nop: function(path) {

			if ($('.magazine').turn('is'))
				$('.magazine').turn('page', 1);
		}
	});


	$(window).resize(function() {
		resizeViewport();
	}).bind('orientationchange', function() {
		resizeViewport();
	});

	// Regions

	if ($.isTouch) {
		$('.magazine').bind('touchstart', regionClick);
	} else {
		$('.magazine').click(regionClick);
	}

	// Events for the next button

	$('.next-button').bind($.mouseEvents.over, function() {
		
		$(this).addClass('next-button-hover');

	}).bind($.mouseEvents.out, function() {
		
		$(this).removeClass('next-button-hover');

	}).bind($.mouseEvents.down, function() {
		
		$(this).addClass('next-button-down');

	}).bind($.mouseEvents.up, function() {
		
		$(this).removeClass('next-button-down');

	}).click(function() {
		
		$('.magazine').turn('next');
        stopAllSounds();
        
	});

	// Events for the next button
	
	$('.previous-button').bind($.mouseEvents.over, function() {
		
		$(this).addClass('previous-button-hover');

	}).bind($.mouseEvents.out, function() {
		
		$(this).removeClass('previous-button-hover');

	}).bind($.mouseEvents.down, function() {
		
		$(this).addClass('previous-button-down');

	}).bind($.mouseEvents.up, function() {
		
		$(this).removeClass('previous-button-down');

	}).click(function() {
		
		$('.magazine').turn('previous');
            stopAllSounds();

	});


	// Slider

	$( "#slider" ).slider({
		min: 1,
		max: numberOfViews(flipbook),
/*
		start: function(event, ui) {

			if (!window._thumbPreview) {
				_thumbPreview = $('<div />', {'class': 'thumbnail'}).html('<div></div>');
				setPreview(ui.value);
				_thumbPreview.appendTo($(ui.handle));
			} else
				setPreview(ui.value);

			moveBar(false);

		},
*/
		slide: function(event, ui) {

			setPreview(ui.value);

		},

		stop: function() {

			if (window._thumbPreview)
				_thumbPreview.removeClass('show');
			
			$('.magazine').turn('page', Math.max(1, $(this).slider('value')*2 - 2));

		}
	});

	resizeViewport();

	$('.magazine').addClass('animated');

}

// Zoom icon

 $('.zoom-icon').bind('mouseover', function() { 
 	
 	if ($(this).hasClass('zoom-icon-in'))
 		$(this).addClass('zoom-icon-in-hover');

 	if ($(this).hasClass('zoom-icon-out'))
 		$(this).addClass('zoom-icon-out-hover');
 
 }).bind('mouseout', function() { 
 	
 	 if ($(this).hasClass('zoom-icon-in'))
 		$(this).removeClass('zoom-icon-in-hover');
 	
 	if ($(this).hasClass('zoom-icon-out'))
 		$(this).removeClass('zoom-icon-out-hover');

 }).bind('click', function() {

 	if ($(this).hasClass('zoom-icon-in'))
 		$('.magazine-viewport').zoom('zoomIn');
 	else if ($(this).hasClass('zoom-icon-out'))	
		$('.magazine-viewport').zoom('zoomOut');

 });
      
    
function visibleNext(){
    $("#activeNext").css("display","block")
}    
    
    
    function stopAllSounds(){
        $("#activeNext").css("display","none");
        playing = false;
        audiosNumbers();
       audioPlayer = document.getElementById("audio" +  audioReady);
        $("#buttonPlay").attr("src","images/Play.png");
          for(i= 0; i<=6;i++){
                    var audio = document.getElementById("audio" + i);
                        audio.pause();
                        audio.currentTime = 0;
                    
                } 
        
    }

    
function audiosNumbers(){
               
            switch(audioNumber){
                case 1:
                    audioReady = 0
                   break;
                case 2:
                    audioReady = 0
                   break;
                case 3:
                    audioReady = 0
                   break;
                case 4:
                    audioReady = 1
                   break;
                case 5:
                    audioReady = 1
                   break;
                case 6:
                    audioReady = 2
                   break;
                case 7:
                    audioReady = 2
                   break;
                case 8:
                    audioReady = 3
                   break;
                case 9:
                    audioReady = 3
                   break;
                case 10:
                    audioReady = 4
                   break;
                case 11:
                    audioReady = 4
                   break;
                case 12:
                    audioReady = 5
                   break;
                case 13:
                    audioReady = 5
                   break;
                case 14:
                    audioReady = 6
                   break;
                case 15:
                    audioReady = 6
                   break;
                case 16:
                    audioReady = 0
                   break;
            
            }
}    

    
$("#buttonPlay").click(function(){
   if(!playing) {
        $("#buttonPlay").attr("src","images/Pause.png");
       autoPlay();
       audioPlayer.currentTime = 0;
   }else{
       
            if (audioPlayer.paused) {
                audioPlayer.play();
                    $("#buttonPlay").attr("src","images/Pause.png");
                } else {
                    audioPlayer.pause();
                    $("#buttonPlay").attr("src","images/Play.png");
                }
       if(language == "ES"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaES" + audioReady)); 
        }else if(language == "EN"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaEN" + audioReady));
        }else if(language == "KO"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaKO" + audioReady));
        }
       
       
   }    
    
});

function autoPlay(){
    audiosNumbers();
    console.log("audioReady: " + audioReady);
    audioPlayer = document.getElementById("audio" +  audioReady); 
      
    if(audioNumber == 16){
        $("#buttonPlay").attr("src","images/Play.png");
    }else{
        audioPlayer.play();
        if(language == "ES"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaES" + audioReady)); 
        }else if(language == "EN"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaEN" + audioReady));
        }else if(language == "KO"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaKO" + audioReady));
        }        
        audioPlayer.addEventListener("timeupdate", function(e){
            playing = true;
        });

    }
}       
    
 $('#canvas').hide();


yepnope({
	test : Modernizr.csstransforms,
	yep: ['lib/turn.min.js'],
	nope: ['lib/turn.html4.min.js', 'css/jquery.ui.html4.css'],
	both: ['lib/zoom.min.js', 'css/jquery.ui.css', 'js/magazine.js', 'css/magazine.css','css/custom_fonts.css'],
	complete: loadApp
});
/*MIX PANEL*/
var credentials = epicModel.getCredentials();    
var allPages =  18    
    
    
$(document).ready(function () {
    /**
     * * Metodo implementado en mixpanel.js
     */
    var credentials1 = epicModel.getCredentials();   

    mixpanel.track(
        "OnBookOpen",
        {
            "user_id": credentials1.educationID,
            "app": "web",
            "bookID" : "27",
            "bookName" : "Eagle entiende la navidad"
        }
    );
    
    

    
});    

function mixPanelClose(){
        mixpanel.track(
            "OnBookClose", 
            {
                "user_id": credentials.educationID,
                "app": "web",
                "bookID" : "27",
                "bookName" : "Eagle entiende la navidad",
                "lastPage" : audioNumber
            }
        );
}   
    

    function stopAllSounds(){
        if(audioNumber >= [allPages-2]){
                mixpanel.track("OnBookFinished",{
                        "user_id": credentials.educationID,
                        "app": "web",
                        "bookID" : "27",
                        "bookName" : "Eagle entiende la navidad"
                    });      
        }
        
        
        $("#activeNext").css("display","none");
        playing = false;
        audiosNumbers();
       audioPlayer = document.getElementById("audio" +  audioReady);
        $("#buttonPlay").attr("src","images/Play.png");
          for(i= 0; i<=6;i++){
                    var audio = document.getElementById("audio" + i);
                        audio.pause();
                        audio.currentTime = 0;
                    
                } 
        
    }    
    
    var leaving = true;
    var isClose = false;

    function EndChatSession() {
        var request = GetRequest();
        request.open("GET", "../Chat.aspx", true);
        request.send();
    }
    document.onkeydown = checkKeycode
    function checkKeycode(e) {
        var keycode;
        if (window.event)
            keycode = window.event.keyCode;
        else if (e)
            keycode = e.which;
        if (keycode == 116) {
            isClose = true;
        }
    }
    function somefunction() {
        isClose = true;
    }
    
    window.onbeforeunload = function (e) {
       if (!e) e = event;
        if (leaving) {
             EndChatSession();
             mixPanelClose();
             //e.returnValue = "Are You Sure";

        }
    }
    function GetRequest() {
        var xmlHttp = null;
        try {
            // Firefox, Opera 8.0+, Safari
            xmlHttp = new XMLHttpRequest();
        }
        catch (e) {
            //Internet Explorer
            try {
                xmlHttp = new ActiveXObject("Msxml2.XMLHTTP");
            }
            catch (e) {
                xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
        }
        return xmlHttp;
    }  
</script>
</body>
</html>
