<!doctype html>
<html>
<head>
<title class="languageTitle">Eagle entiende la navidad</title>
 <meta charset="UTF-8">    
<meta name="viewport" content="width = 1050, user-scalable = no" />
<link rel="icon" type="image/png" href="../../pics/favicon.png" />
<script type="text/javascript" src="extras/jquery.min.1.7.js"></script>
<script type="text/javascript" src="extras/jquery-ui-1.8.20.custom.min.js"></script>
<script type="text/javascript" src="extras/modernizr.2.5.3.min.js"></script>
<script type="text/javascript" src="lib/hash.js"></script>
<script type="text/javascript" src="js/jquery.blast.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js"></script>
    <script type="text/javascript" src="js/tracks.js"></script>
<script type="text/javascript" src="js/audioSync.js"></script>    
<script>
    var languageTitles = [
            {
                ES:"Eagle entiende la navidad",
                EN:"Eagle learns about Christmas",
                PT:"Eagle entende o Natal",
                ZH:"伊戈领悟圣诞节的真谛",
                JA:"イーグルとクリスマス",
                KO:"이글이의 크리스마스 이해하기"
            }
        ]
    
    var language = "EN"
    if(parent.window.location.search){
        var params = parent.window.location.search.trim(1)
        var regex = /language=(..)/i
        var result = regex.exec(params)
        if(result){
            language = result[result.index].toUpperCase()    
        }else{
            language = "ES"
        } 
    } 
    
     function changeTitle(){
        if(language == "ES"){
            $(".languageTitle").text(languageTitles[0][language])
        }else if(language == "EN"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else if(language == "PT"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else if(language == "ZH"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else if(language == "JA"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else if(language == "KO"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else{
            $(".languageTitle").text(languageTitles[0].EN)    
        }
    }    
    
    changeTitle()
    
var languagePages = [
                {
                    page:1,
                    ES:"En su laboratorio Eagle se encontraba, pensando qué regalar, mientras los otros la casa decoraban. Era Navidad y a Eagle no le emocionaba.",
                    EN:"Eagle was in his laboratory thinking of the presents he would give on Christmas, while the rest of his friends were decorating the house. Eagle was not excited.",
                    PT:"Eagle estava em seu laboratório, pensando nos presentes que daria no Natal, enquanto seus amigos enfeitavam a casa. Eagle não estava muito empolgado.",
                    ZH:"伊戈正在他的实验室里思索着圣诞节送什么礼物，而他的朋友们正在装饰房子。伊戈并没有兴奋的感觉。",
                    JA:"イーグルはクリスマスにわたすプレゼントのことをかんがえていました。ともだちはみんな、いえのかざりつけをしています。イーグルはたのしくありません。",
                    KO:"이글이는 실험실에서 친구들에게 줄 크리스마스 선물을 곰곰히 생각하고 있었어요. 이글이 친구들은 집을 예쁘게 꾸미고 있었지만 이글이는 전혀 관심이 없었어요."
                },
                {
                    page:2,
                    ES:"¡JO-JO-JO! Sonó e Eagle volteó. Era un viejo barbón que a Eagle preguntó: ¿Qué pasa Yogotar? ¿Por qué no sales a decorar?",
                    EN:"HO-HO HO! Eagle turned to find an old bearded man who asked What's wrong Yogotar? Why aren't you decorating the house?",
                    PT:'“HO HO HO!" Eagle se virou e viu um velhinho barbudo, que perguntou: “Qual o problema, Yogotar? Por que você não está enfeitando a casa?”',
                    ZH:"“呵呵呵！”伊戈转过身来，看到一位满脸胡须的老人问他：“怎么了，Yogotar？你为什么不装饰房子呢？”如果我没有礼物要送，我该怎么装饰呢？我不知道该送朋友什么。",
                    JA:"「ホー、ホー、ホー！」イーグルがふりかえるとひげのおじいさんがいました。「ヨゴター、どうしたんだい？なぜいえのかざりつけをしないんだい？」",
                    KO:"“호-호-호!” 이글이는 고개를 돌려 수염이 긴 할아버지를 보았어요. 할아버지는 이렇게 물으셨어요. “무슨 일이 있니 요고타야? 왜 친구들과 함께 집을 꾸미지 않는거니?”"
                },
                {
                    page:3,
                    ES:"¿Con qué he de decorar si no tengo que regalar? No dejo de pensar, pero nada puedo crear.",
                    EN:"How can I decorate if I have no presents to give? I have no idea what to give my friends.",
                    PT:"Como eu posso enfeitar a casa se não tenho presentes para dar? Não faço ideia do que vou dar para meus amigos.",
                    ZH:"如果我没有礼物要送，我该怎么装饰呢？我不知道该送朋友什么。",
                    JA:"わたすプレゼントがないのにかざりつけなんてしてもしかたないよ。ともだちになにをあげたらいいかわからないんだ。",
                    KO:"친구들에게 줄 선물이 없는데 어떻게 집을 꾸밀 수 있겠어요? 친구들에게 뭘 선물할지 전혀 모르겠어요."
                },
                {
                    page:4,
                    ES:"¡JO-JO-JO! Mi querido Yogotar, la navidad no se trata de regalar, se trata de hornear, cenar y en familia disfrutar.",
                    EN:"HO-HO-HO! My dear Yogotar, Christmas is not about giving presents, it's about enjoying some time together with your friends and family. ",
                    PT:'HO HO HO! Meu bom Yogotar, o Natal não é só dar presentes. O importante é passar tempo com seus amigos e sua família.',
                    ZH:"呵呵呵！亲爱的Yogotar，圣诞节的意义不是送礼物，而是和你的朋友家人享受在一起的时光。",
                    JA:"ホー、ホー、ホー！プレゼントをわたすことだけがクリスマスではない。ともだちやかぞくとたのしくすごすのがクリスマスさ。",
                    KO:"호-호-호!우리사랑스러운요고타야,크리스마스선물을주는게중요한게아니란다.크리스마스는가족과친구들과함께모여서즐거운시간을갖는게중요한거란다."
                },
                {
                    page:5,
                    ES:"- ¡Lo tengo! Ya sé que les voy a regalar- dijo Eagle, antes de ponerse a trabajar en una gran estrella, para el árbol adornar.",
                    EN:"I've got it! I know what I'll give my friends, said Eagle. Eagle began working on a big star to decorate the Christmas Tree.",
                    PT:'“Entendi! Já sei o que vou dar para os meus amigos”, disse Eagle. Eagle começou a fazer uma grande estrela para enfeitar a Árvore de Natal.',
                    ZH:"“我知道了！我知道该送朋友什么了。”伊戈说。伊戈开始制作一颗大星星，用来装饰圣诞树。",
                    JA:"「そうか！ともだちになにをあげたらいいかわかったよ」イーグルはいいました。イーグルはクリスマスツリーにかざるおおきなほしをつくりはじめました。",
                    KO:"“아!알겠어요!이제친구들에게뭘선물하지생각이났어요!”이글이가말했어요.이글이는크리스마스트리에장식할큰별을만들기시작했어요."
                },
                {
                    page:6,
                    ES:"Entonces nuestro querido Yogotar la estrella colocó y a todos juntó, para cantar, disfrutar y con sus sonrisas a la navidad iluminar. ",
                    EN:"Then, our dear Yogotar put the star on top of the tree. His friends gathered around to sing and enjoy their time together. The bright smiles on their faces lit up Christmas.",
                    PT:"Depois, nosso querido Yogotar colocou a estrela no alto da árvore. Seus amigos se reuniram em volta para cantar e passar tempo juntos. O sorriso brilhante no rosto deles iluminou o Natal.",
                    ZH:"然后，我们亲爱的Yogotar把星星放在树冠上。他的朋友们围坐在一起唱歌，享受欢聚的时光。他们脸上灿烂的笑容照亮了圣诞节。",
                    JA:"ヨゴターはツリーのてっぺんにほしをつけました。ともだちがあつまってきてうたをうたいたのしいときをすごしました。みんなのえがおがキラキラとしてクリスマスをいろどりました。",
                    KO:"마침내 우리의 사랑스러운 요고타는 큰 별을 트리 맨 꼭대기에 달았어요. 그리고 친구들과 함께 모여서 같이 노래를 부르고 즐거운 시간을 보냈어요. 모두의 얼굴에 웃음꽃이 활짝 피었어요."
                }
                ]    
    </script>   
</head>
<body>

<div id="canvas">

<div class="zoom-icon zoom-icon-in"></div>

<div class="magazine-viewport">
	<div class="container">
        
		<div class="magazine">
            <div id="p1" depth="5" class="hard"> <div class="side"></div> </div>
			<div depth="5" class="hard front-side"> <div class="depth"></div> </div>
			<div class="hard fixed back-side p17"></div>
			<div class="hard p18"></div>

            </div>
            <script>
                //console.log(languagePages[0][language]);
                if(language == "ES"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1ES.png')");
                }else if(language == "EN"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1EN.png')");
                }else if(language == "ZH"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1ZH.png')");
                }else if(language == "KO"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1KO.png')");
                }else if(language == "JA"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1JA.png')");
                }else if(language == "PT"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1PT.png')");
                }else{
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1EN.png')");
                }
            
            </script>
        
        
			<!-- Next button -->
		</div>
	</div>
   <a onclick="goBack()"><div id="homeButton"><img src="images/homeButton.png" /></div></a>

<script>
function goBack() {
    window.location.href="../../yogobooks.html";
}
</script>
    <div class="languageButton"><img src="images/icon-languages.png"></div>
    <div class="idiomas">
        <div id="ButtonLanEs" class="overLanguage">Español</div>
        <div id="ButtonLanEn" class="overLanguage">English</div>
    </div>
    <div id="audiosGroup"></div>
	<div class="bottom">
        <div ignore="1" class="next-button">
            <div id="activeNext">
                <img src="images/nextButtonActive.png">
            </div>
            <img src="images/nextButton.png">
            </div>
			<!-- Previous button -->
			<div ignore="1" class="previous-button">
    <img src="images/prevButton.png">
            </div>        
		<div id="slider-bar" class="turnjs-slider timeline-style">
			<div id="slider">
            </div>
		</div>
         <div id="sectionPlayButton" ><img id="buttonPlay" src="images/Play.png"></div>
	</div>
    
</div>

<script type="text/javascript">
    $("#sectionPlayButton").hide();
    var audioNumber;
    var clearTimeOut;
    var audioReady;
    var playing = false;
    var audioPlayer; 
    //cambio de regex
    function replaceQueryParam(param, newval, search) {
        var regex = new RegExp("([?;&])" + param + "[^&;]*[;&]?");
        var query = search.replace(regex, "$1").replace(/&$/, '');

        return (query.length > 2 ? query + "&" : "?") + (newval ? param + "=" + newval : '');
    }    
    
    
    $("#ButtonLanEs").click(function(){

        var str = window.location.search
        str = replaceQueryParam('language', "ES", str)
        window.location = window.location.pathname + str + "#page/" + audioNumber;
    });
    
    $("#ButtonLanEn").click(function(){

        var str = window.location.search
        str = replaceQueryParam('language', "EN", str)
        window.location = window.location.pathname + str + "#page/" + audioNumber;
    });
    
    $(".languageButton").click(function(){
        var idioma = $(".idiomas");
        if (idioma.css("display") === "block") {
            idioma.css("display","none");
        } else {
            idioma.css("display","block");
        }
    
        
    });
    
    TweenMax.fromTo($("#activeNext"),1,{alpha:0.5},{alpha:1,yoyo:true,repeat:-1});
    
    $("#audiosGroup").append('<audio id="audio0" preload="true" src="audios/' +  0 + '.mp3"></audio>') 
    for(var i = 1;i<=6;i++){
       $("#audiosGroup").append('<audio id="audio'+i+'" preload="true" src="audios/' +[language] + "/" +  i + '.mp3"></audio>')  
    }
    

function loadApp() {

 	$('#canvas').fadeIn(1000);

 	var flipbook = $('.magazine');

 	// Check if the CSS was already loaded
	
	if (flipbook.width()==0 || flipbook.height()==0) {
		setTimeout(loadApp, 10);
		return;
	}
	
	// Create the flipbook

	flipbook.turn({
			
			// Magazine width

			width: 922,

			// Magazine height

			height: 600,

			// Duration in millisecond

			duration: 1000,

			// Enables gradients

			gradients: true,
			
			// Auto center this flipbook

			autoCenter: true,

			// Elevation from the edge of the flipbook when turning a page

			elevation: 50,

			// The number of pages

			pages: 18,

			// Events

			when: {
                
                
                
				turning: function(event, page, view) {
					
					var book = $(this),
					currentPage = book.turn('page'),
					pages = book.turn('pages');
                    
		

				updateDepth(book, page);
				
				if (page>=2)
					$('.magazine .p2').addClass('fixed');
				else
					$('.magazine .p2').removeClass('fixed');

				if (page<book.turn('pages'))
					$('.magazine .p17').addClass('fixed');
				else
					$('.magazine .p17').removeClass('fixed');
                    
                    if(language == "ES"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2ES.png')");
                }else if(language == "EN"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2EN.png')");
                }else if(language == "ZH"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2ZH.png')");
                }else if(language == "KO"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2KO.png')");
                }else if(language == "JA"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2JA.png')");
                }else if(language == "PT"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2PT.png')");
                }else{
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2EN.png')");
                }


					Hash.go('page/' + page).update();

					// Show and hide navigation buttons
                    audioNumber = page;
					disableControls(page);

				},
                
				turned: function(event, page, view) {

					disableControls(page);
                    var object = $(this);

					$(this).turn('center');
                   

					$('#slider').slider('value', getViewNumber(object, page));
                    audioNumber = page;
            
					if (page==1) { 
						$(this).turn('peel', 'br');
					}

				},

				missing: function (event, pages) {

					// Add pages that aren't in the magazine

					for (var i = 0; i < pages.length; i++)
						addPage(pages[i], $(this));

				}
			}

        
	});

	// Zoom.js

    
    
	$('.magazine-viewport').zoom({
		flipbook: $('.magazine'),

		max: function() { 
			
			return largeMagazineWidth()/$('.magazine').width();

		}, 

		when: {
			swipeLeft: function() {

				$(this).zoom('flipbook').turn('next');
                
                stopAllSounds();

			},

			swipeRight: function() {
				
				$(this).zoom('flipbook').turn('previous');
                stopAllSounds();

			},

			resize: function(event, scale, page, pageElement) {

//				if (scale==1)
//					loadSmallPage(page, pageElement);
//				else
//					loadLargePage(page, pageElement);

			},

			zoomIn: function () {

				$('#slider-bar').hide();
				$('.made').hide();
				$('.magazine').removeClass('animated').addClass('zoom-in');
				$('.zoom-icon').removeClass('zoom-icon-in').addClass('zoom-icon-out');
				
				if (!window.escTip && !$.isTouch) {
					escTip = true;

					$('<div />', {'class': 'exit-message'}).
						html('<div>Press ESC to exit</div>').
							appendTo($('body')).
							delay(2000).
							animate({opacity:0}, 500, function() {
								$(this).remove();
							});
				}
			},

			zoomOut: function () {

				$('#slider-bar').fadeIn();
				$('.exit-message').hide();
				$('.made').fadeIn();
				$('.zoom-icon').removeClass('zoom-icon-out').addClass('zoom-icon-in');

				setTimeout(function(){
					$('.magazine').addClass('animated').removeClass('zoom-in');
					resizeViewport();
				}, 0);

			}
		}
	});

	// Zoom event

	if ($.isTouch)
		$('.magazine-viewport').bind('zoom.doubleTap', zoomTo);
	else
		$('.magazine-viewport').bind('zoom.tap', zoomTo);


	// Using arrow keys to turn the page

	$(document).keydown(function(e){

		var previous = 37, next = 39, esc = 27;

		switch (e.keyCode) {
			case previous:

				// left arrow
				$('.magazine').turn('previous');
                stopAllSounds();
                
				e.preventDefault();

			break;
			case next:

				//right arrow
				$('.magazine').turn('next');
                stopAllSounds();
				e.preventDefault();

			break;
			case esc:
				
				$('.magazine-viewport').zoom('zoomOut');	
				e.preventDefault();

			break;
		}
	});

	// URIs - Format #/page/1 

    
    
	Hash.on('^page\/([0-9]*)$', {
		yep: function(path, parts) {
			var page = parts[1];

			if (page!==undefined) {
				if ($('.magazine').turn('is'))
					$('.magazine').turn('page', page);
                audioReady = page;
                
			}

		},
		nop: function(path) {

			if ($('.magazine').turn('is'))
				$('.magazine').turn('page', 1);
		}
	});


	$(window).resize(function() {
		resizeViewport();
	}).bind('orientationchange', function() {
		resizeViewport();
	});

	// Regions

	if ($.isTouch) {
		$('.magazine').bind('touchstart', regionClick);
	} else {
		$('.magazine').click(regionClick);
	}

	// Events for the next button

	$('.next-button').bind($.mouseEvents.over, function() {
		
		$(this).addClass('next-button-hover');

	}).bind($.mouseEvents.out, function() {
		
		$(this).removeClass('next-button-hover');

	}).bind($.mouseEvents.down, function() {
		
		$(this).addClass('next-button-down');

	}).bind($.mouseEvents.up, function() {
		
		$(this).removeClass('next-button-down');

	}).click(function() {
		
		$('.magazine').turn('next');
        stopAllSounds();
        
	});

	// Events for the next button
	
	$('.previous-button').bind($.mouseEvents.over, function() {
		
		$(this).addClass('previous-button-hover');

	}).bind($.mouseEvents.out, function() {
		
		$(this).removeClass('previous-button-hover');

	}).bind($.mouseEvents.down, function() {
		
		$(this).addClass('previous-button-down');

	}).bind($.mouseEvents.up, function() {
		
		$(this).removeClass('previous-button-down');

	}).click(function() {
		
		$('.magazine').turn('previous');
            stopAllSounds();

	});


	// Slider

	$( "#slider" ).slider({
		min: 1,
		max: numberOfViews(flipbook),
/*
		start: function(event, ui) {

			if (!window._thumbPreview) {
				_thumbPreview = $('<div />', {'class': 'thumbnail'}).html('<div></div>');
				setPreview(ui.value);
				_thumbPreview.appendTo($(ui.handle));
			} else
				setPreview(ui.value);

			moveBar(false);

		},
*/
		slide: function(event, ui) {

			setPreview(ui.value);

		},

		stop: function() {

			if (window._thumbPreview)
				_thumbPreview.removeClass('show');
			
			$('.magazine').turn('page', Math.max(1, $(this).slider('value')*2 - 2));

		}
	});

	resizeViewport();

	$('.magazine').addClass('animated');

}

// Zoom icon

 $('.zoom-icon').bind('mouseover', function() { 
 	
 	if ($(this).hasClass('zoom-icon-in'))
 		$(this).addClass('zoom-icon-in-hover');

 	if ($(this).hasClass('zoom-icon-out'))
 		$(this).addClass('zoom-icon-out-hover');
 
 }).bind('mouseout', function() { 
 	
 	 if ($(this).hasClass('zoom-icon-in'))
 		$(this).removeClass('zoom-icon-in-hover');
 	
 	if ($(this).hasClass('zoom-icon-out'))
 		$(this).removeClass('zoom-icon-out-hover');

 }).bind('click', function() {

 	if ($(this).hasClass('zoom-icon-in'))
 		$('.magazine-viewport').zoom('zoomIn');
 	else if ($(this).hasClass('zoom-icon-out'))	
		$('.magazine-viewport').zoom('zoomOut');

 });
      
    
function visibleNext(){
    $("#activeNext").css("display","block")
}    
    
    
    function stopAllSounds(){
//        $("#activeNext").css("display","none");
//        playing = false;
//        audiosNumbers();
//       audioPlayer = document.getElementById("audio" +  audioReady);
//        $("#buttonPlay").attr("src","images/Play.png");
//          for(i= 0; i<=6;i++){
//                    var audio = document.getElementById("audio" + i);
//                        audio.pause();
//                        audio.currentTime = 0;
//                    
//                } 
        
    }

    
function audiosNumbers(){
               
            switch(audioNumber){
                case 1:
                    audioReady = 0
                   break;
                case 2:
                    audioReady = 0
                   break;
                case 3:
                    audioReady = 0
                   break;
                case 4:
                    audioReady = 1
                   break;
                case 5:
                    audioReady = 1
                   break;
                case 6:
                    audioReady = 2
                   break;
                case 7:
                    audioReady = 2
                   break;
                case 8:
                    audioReady = 3
                   break;
                case 9:
                    audioReady = 3
                   break;
                case 10:
                    audioReady = 4
                   break;
                case 11:
                    audioReady = 4
                   break;
                case 12:
                    audioReady = 5
                   break;
                case 13:
                    audioReady = 5
                   break;
                case 14:
                    audioReady = 6
                   break;
                case 15:
                    audioReady = 6
                   break;
                case 16:
                    audioReady = 0
                   break;
            
            }
}    

    
$("#buttonPlay").click(function(){
   if(!playing) {
        $("#buttonPlay").attr("src","images/Pause.png");
       autoPlay();
       audioPlayer.currentTime = 0;
   }else{
       
            if (audioPlayer.paused) {
                audioPlayer.play();
                    $("#buttonPlay").attr("src","images/Pause.png");
                } else {
                    audioPlayer.pause();
                    $("#buttonPlay").attr("src","images/Play.png");
                }
       if(language == "ES"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaES" + audioReady)); 
        }else if(language == "EN"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaEN" + audioReady));
        }else{
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaES" + audioReady));
        }       
       
       
   }    
    
});

function autoPlay(){
    audiosNumbers();
    console.log("audioReady: " + audioReady);
    audioPlayer = document.getElementById("audio" +  audioReady); 
      
    if(audioNumber == 16){
        $("#buttonPlay").attr("src","images/Play.png");
    }else{
        audioPlayer.play();
        if(language == "ES"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaES" + audioReady)); 
        }else if(language == "EN"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaEN" + audioReady));
        }else{
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaES" + audioReady));
        }         
        audioPlayer.addEventListener("timeupdate", function(e){
            playing = true;
        });

    }
}       
    
 $('#canvas').hide();


yepnope({
	test : Modernizr.csstransforms,
	yep: ['lib/turn.min.js'],
	nope: ['lib/turn.html4.min.js', 'css/jquery.ui.html4.css'],
	both: ['lib/zoom.min.js', 'css/jquery.ui.css', 'js/magazine.js', 'css/magazine.css','css/custom_fonts.css'],
	complete: loadApp
});

</script>
</body>
</html>