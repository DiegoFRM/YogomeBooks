<!doctype html>
<html>
<head>
<title class="languageTitle">Héroe</title>
 <meta charset="UTF-8">    
<meta name="viewport" content="width = 1050, user-scalable = no" />
<link rel="icon" type="image/png" href="../../pics/favicon.png" />
<script type="text/javascript" src="extras/jquery.min.1.7.js"></script>
<script type="text/javascript" src="extras/jquery-ui-1.8.20.custom.min.js"></script>
<script type="text/javascript" src="extras/modernizr.2.5.3.min.js"></script>
<script type="text/javascript" src="lib/hash.js"></script>
<script type="text/javascript" src="js/jquery.blast.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js"></script>
    <script type="text/javascript" src="js/tracks.js"></script>
<script type="text/javascript" src="js/audioSync.js"></script> 
    <!--ESta de manera absoluta la direccion de epic model, por la profundidad que tiene dentro del server-->
<script type="text/javascript" src="http://play.yogome.com/js/epic/models/epicModel.js"></script>    
<script type="text/javascript" src="../../js/mixpanel/mixpanel.js"></script>     
    
    <script>
        var meta = document.createElement('meta');
        meta.setAttribute("property","og:description");
        
    </script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta property="og:url"				content="https://play.yogome.com/yogomebooks/33/#EN"/>
    <meta property="og:type"			content="article" />
    <meta property="og:title"			content="Interactive Book: Hero" />
    <meta property="og:image"			content="https://play.yogome.com/yogomebooks/posts/fbpost_33.png" />
    
    
<script>
    var languageTitles = [
            {
                ES:"Héroe",
                EN:"Hero",
                PT:"Herói",
                ZH:"英雄",
                JA:"ヒーロー",
                KO:"영웅"
            }
        ]
    
    //AQUI VA PARA SABER EL LENGUAGE
        function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}

        var language

      var  str =window.location.hash;
        var array=str.split("/")
        language=array[0].substr(1)
        console.log(language) 
    
    function changeTitle(){
        if(language == "ES"){
            $(".languageTitle").text(languageTitles[0][language])
        }else if(language == "EN"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else if(language == "PT"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else if(language == "ZH"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else if(language == "JA"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else if(language == "KO"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else{
            $(".languageTitle").text(languageTitles[0].EN)    
        }
    }    
    
    changeTitle()

var languagePages = [
                  {
                    page:1,
                    ES:"Después de una exitosa misión, los Yogotars llegaron a la academia. Oof sólo pensaba en comida, Estrella y Dinamita sólo querían ver el fútbol. Mientras Luna sólo tenía cabeza para encontrar la cura de una enfermedad desconocida.",
                    EN:"After a successful mission, the Yogotars went back to the academy. Oof could only think about food, Estrella and Dinamita just wanted to watch football, and Luna was focused on finding the cure for a rare disease.",
                    PT:"Depois de uma missão bem-sucedida, os Yogotars voltaram para a academia. Oof só pensava em comida, Estrella e Dinamita queriam assistir ao jogo de futebol, e Luna estava concentrada em encontrar a cura para uma doença rara.",
                    ZH:"圆满完成任务后，Yogotar们回到了学院。奥夫只想吃东西，埃斯特雷拉和迪纳米特只想看足球赛，而鲁娜则在专心致志地寻找治疗罕见疾病的方法。",
                    JA:"ミッションを ぶじに おえた ヨゴターたちは、アカデミーに かえってきました。ウーフは たべることで あたまがいっぱいです。エストレラとディナミタは フットボールを 見ることになっています。ルナは めずらしい びょうきをなおす ほうほうを けんきゅうしています。",
                    KO:"미션을 성공적으로 마친 요고타들은 아카데미로 돌아왔어요. 우프는 음식을 먹을 생각만 하고 있었고, 에스트레야와 다이나미타는 축구 경기를 보고 싶었어요. 그리고 루나는 희귀한 질병을 치료할 방법을 찾는 데 집중하고 있었어요."
                },
                {
                    page:2,
                    ES:"Tomiko esperó a que todos iniciaran sus actividades y se acercó a Eagle.</br></br> -Oye Eagle, ¿Qué debo hacer para ser una heroína? –preguntó Tomiko.</br> Eagle la observó con sorpresa.",
                    EN:"Tomiko waited for everyone to start their activities and approached Eagle.</br></br> &#34;Hey Eagle, what should I do to become a hero?&#34; asked Tomiko. </br></br>Surprised, Eagle looked at her inquisitively.",
                    PT:'Tomiko esperou todo mundo começar suas atividades e foi falar com Eagle. </br></br>&#34;Eagle, o que eu preciso fazer para me tornar uma heroína?&#34;, perguntou Tomiko. </br></br> Surpreso, Eagle olhou para ela com cara de curiosidade.',
                    ZH:"富子等大家都忙起来后，朝伊戈走去。</br></br>&#34;嘿，伊戈，我怎么做才能成为英雄？&#34;富子问。 </br></br>伊戈吃惊而狐疑地看着她。",
                    JA:"トミコは みんながそれぞれ いそがしくなるのをまって、イーグルに 近づきました。</br></br>ねえ イーグル、どうすれば ヒーローになれるの？」トミコが たずねました。</br></br>イーグルは おどろいて、ふしぎなかおで トミコをみつめました。",
                    KO:"토미코는 친구들이 흩어질 때까지 기다렸다가 이글이에게 다가갔어요.</br></br>&#34;이글아, 영웅이 되려면 무엇을 해야 할까?&#34; 토미코가 물었어요.</br></br>놀란 이글이가 호기심이 가득한 눈으로 토미코를 바라봤어요."
                },
                {
                    page:3,
                    ES:"¿Qué te hace pensar que no eres una? –preguntó Eagle.</br> -Hace unos momentos enfrentamos a una banda de maleantes y apenas pude enfrentar a uno -dijo Tomiko. ",
                    EN:"&#34;What makes you think you aren't one already?&#34 asked Eagle.</br></br> &#34We just faced a group of bad guys and I could barely fight one&#34, replied Tomiko.",
                    PT:"&#34;O que faz você pensar que não é uma heroína?&#34;, perguntou Eagle.</br></br>&#34;A gente acabou de enfrentar um grupo de vilões, e eu mal consegui lutar contra um deles&#34;, respondeu Tomiko.",
                    ZH:"&#34;您为什么认为自己还不是英雄？&#34;伊戈问道。</br></br>&#34;我们刚刚面对一群坏蛋，而我却仅能勉强应付一个，&#34;富子回答。",
                    JA:"「どうして じぶんが ヒーローじゃないと おもうんだい？」イーグルが たずねました。</br></br>「さっき わるものたちと たたかったとき、わたし ほとんどなにも できなかったわ」トミコは こたえました。",
                    KO:"&#34;왜 네가 아직도 영웅이 아니라고 생각해?&#34; 이글이가 물었어요.</br></br>&#34;우리가 악당들을 만났을 때 나는 겨우 한 명만 상대할 수 있었어.&#34; 토미코가 대답했어요."
                },
                {
                    page:4,
                    ES:"Un héroe no sólo se define por sus habilidades y fuerza. Se define por sus acciones y sobre todo su valor -dijo Eagle.</br></br> -Para ti es fácil decirlo, todos te ven como un héroe -dijo Tomiko sin estar muy convencida. ",
                    EN:"&#34;A hero isn&#39;t only defined by their skills and strength. A hero is defined by their actions, and above all, by their courage said Eagle.&#34;</br></br> &#34;It&#39;s easy for you to say, everybody thinks you&#39;re a hero&#34; said Tomiko, not very convinced.",
                    PT:"&#34;Ser um herói não é só ter habilidades e força. Um herói é definido por suas ações e, acima de tudo, por sua coragem&#34;, disse Eagle.</br></br>&#34;Para você, é fácil dizer. Todo mundo acha que você é um herói&#34;, disse Tomiko, não muito convencida.",
                    ZH:"&#34;评价一个人是不是英雄，不仅仅看这个人的技能和力量。一个人之所以是英雄，是因为这个人的所作所为，最重要的一点就是这个人身上所体现出来的勇气。&#34;伊戈说。</br></br>&#34;你说得倒容易，人人都认为你是一个英雄。&#34;富子不太信服地说道。",
                    JA:"「ヒーローって わざ とか つよさだけで きまるものじゃないよ。どんなこうどうをするか、そしてなによりも ゆうきがあるかどうかで きまるものさ」イーグルは言いました。</br></br>「口で いうのは かんたんよ。みんなイーグルのこと ヒーローだと おもっているもの」トミコは なっとくできずに 言いました。",
                    KO:"&#34;영웅는 능력이나 힘으로 되는 게 아니야. 영웅은 어떤 행동을 하는지, 그리고 무엇보다도 얼마나 용기 있는지를 보고 결정이 되는 거야.&#34; 이글이가 말했어요.</br></br>&#34;너는 그렇게 말하기 쉽겠지. 모두 너를 영웅이라고 생각하니까.&#34; 토미코가 확신 없는 목소리로 말했어요."
                },
                {
                    page:5,
                    ES:"¿Recuerdas aquella vez que se descompuso mi jet pack y casi caigo al abismo? -preguntó Eagle.</br></br> -Sí, recuerdo que me lastimé la pierna, pero logré agarrarte antes de que cayeras -dijo Tomiko.</br> -Cualquier persona que se arriesga por otros es un héroe. Como tú lo hiciste esa vez conmigo.",
                    EN:"&#34;Remember that time when my jet pack broke down and I almost fell into the abyss?&#34; asked Eagle. <br></br>&#34;Yes, I remember hurting my leg, but I managed to grab you before you fell&#34; said Tomiko.</br></br>&#34;Anybody who risks themselves for the sake of another person is a hero. Just like that time you saved me.&#34;",
                    PT:'&#34;Você se lembra daquela vez que minha mochila a jato quebrou, e eu quase caí no abismo?&#34;, perguntou Eagle. </br></br>&#34;Sim, eu me lembro de ter machucado minha perna, mas consegui agarrar você antes que caísse&#34;, disse Tomiko.</br></br>&#34;Qualquer um que se arrisca por outra pessoa é um herói. Igual àquela vez que você me salvou.&#34;',
                    ZH:"&#34;还记得那次我的喷气背包坏了，差点跌入深渊吗？&#34;伊戈问道。 </br></br>&#34;是的，我记得我的腿受伤了，但在你掉下去之前，我设法抓住了你。&#34;富子说。</br></br>&#34;为了别人而甘愿自己冒险的人都是英雄。就像那次你救了我一样。&#34;",
                    JA:"「ぼくのジェットパックが こわれて、ふかいあなに おちそうになったときのこと、おぼえてる？」イーグルが たずねました。 </br></br>「おぼえているわ。わたしは 足を けがしていたけど、あなたが おちるまえに たすけることが できたのよね」トミコが言いました。</br></br>「じぶんを ぎせいにしても ほかの人を たすけようとする人は、ヒーローだよ。トミコが ぼくのことを たすけてくれたときのように。」",
                    KO:"&#34;내 제트팩이 망가져서 내가 깊은 구렁에 빠질뻔할 날을 기억하니?&#34; 이글이가 물었어요.</br></br>&#34;물론이지. 내가 다리를 다치긴 했지만 네가 떨어지기 전에 잡을 수 있었잖아.&#34; 토미코가 말했어요.</br></br>&#34;다른 사람을 돕기 위해서 위험을 무릅쓸 수 있다면 누구라도 영웅이 될 수 있어. 네가 나를 구해주었던 그때처럼.&#34;"
                },
                {
                    page:6,
                    ES:"-¿Entonces todos podemos ser héroes? -preguntó Tomiko.</br> -Así es Tomiko. Tú sin duda eres una de las mejores -dijo Eagle. </br>-¡Eres un gran amigo Eagle! -dijo Tomiko.",
                    EN:"&#34;Can anyone be a hero?&#34; asked Tomiko. </br></br> &#34;That's right, Tomiko! And without a doubt, you are one of the best.&#34; said Eagle. </br></br> &#34;You're a great friend, Eagle!&#34; said Tomiko, grinning.",
                    PT:"&#34;Então, qualquer um pode ser um herói?&#34;, perguntou Tomiko. </br></br>&#34;Isso mesmo, Tomiko! E, sem dúvida, você é uma das melhores&#34;, disse Eagle.</br></br>&#34;Você é um ótimo amigo, Eagle!&#34;, disse Tomiko, sorrindo.",
                    ZH:"&#34;任何人都能成为英雄？&#34;富子问。 </br></br>&#34;没错，富子！毫无疑问，你是最棒的。&#34;伊戈说。  </br></br>&#34;你真是我的好朋友，伊戈！&#34;富子微笑着说。",
                    JA:"「だれにでも ヒーローになれるの？」トミコは ききました。 </br></br>「そのとおりさ！トミコは まちがいなく さいこうの ヒーローのひとりだよ。」イーグルは言いました。 </br></br>ありがとう、イーグル！」トミコは にっこりわらって 言いました。",
                    KO:"&#34;누구든 영웅이 될 수 있다고?&#34; 토미코가 물었어요.</br></br>&#34;바로 그거야 토미코야! 의심할 것도 없이, 넌 최고의 영웅이야.&#34; 이글이가 말했어요.</br></br>&#34;넌 정말 좋은 친구야 이글아!&#34; 토미코가 활짝 웃으면서 말했어요."
                }
                ]     
    
    
    </script>   
</head>
<body>

<div id="canvas">


<div class="magazine-viewport">
	<div class="container">
        
		<div class="magazine">
<!--  BOTON SIGUIENTE      -->
                <div ignore="1" class="next-button">
                    <div id="activeNext" >
                        <div class="animation1"> 
                        </div>
                    </div>
                    <img src="images/nextButton.png">
                </div>
            <!-- Previous button -->
			<div ignore="1" class="previous-button">
    <img src="images/nextButton.png">
            </div>             
            <div id="p1" depth="5" class="hard"> <div class="side"></div> </div>
			<div depth="5" class="hard front-side"> <div class="depth"></div> </div>
			<div class="hard fixed back-side p19"><div class="depth"></div> </div>
			<div class="hard p20"> </div>

            </div>
            <script>
                //console.log(languagePages[0][language]);
                if(language == "ES"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1ES.png')");
                }else if(language == "EN"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1EN.png')");
                }else if(language == "ZH"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1ZH.png')");
                }else if(language == "KO"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1KO.png')");
                }else if(language == "JA"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1JA.png')");
                }else if(language == "PT"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1PT.png')");
                }else{
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1EN.png')");
                }
                
                
                
            </script>
        
        
			<!-- Next button -->
		</div>
	</div>
   <a onclick="goBack()"><div id="homeButton"><img src="images/homeButton.png" /></div></a>

<script>
function goBack() {
    window.location.href="../../books.html?cachebust=“..randomNumber..“&language=“..localization.getLanguage()..“&email=“..email..“&name="+name+"&remoteid=“..remoteID..“&educationid=“..educationID..“&age=“..age..“&app=true”";
}
</script>
    <div class="languageButton"><img src="images/icon-languages.png"></div>
    <div class="idiomas">
        <div id="ButtonLanEs" class="overLanguage">Español</div>
        <div id="ButtonLanEn" class="overLanguage">English</div>
        <div id="ButtonLanZh" class="overLanguage">中國</div>
        <div id="ButtonLanJa" class="overLanguage">日本語</div>
        <div id="ButtonLanKo" class="overLanguage">한국어</div>
        <div id="ButtonLanPt" class="overLanguage">PORTUGUES</div>
    </div>
    <div id="audiosGroup"></div>
	<div class="bottom">    
		<div id="slider-bar" class="turnjs-slider timeline-style">
			<div id="slider">
            </div>
		</div>
	</div>
    
</div>

<script type="text/javascript">
    var audioNumber;
    var clearTimeOut;
    var audioReady;
    var playing = false;
    var audioPlayer; 
    //cambio de regex
    function replaceQueryParam(param, newval, search) {
        var regex = new RegExp("([?;&])" + param + "[^&;]*[;&]?");
        var query = search.replace(regex, "$1").replace(/&$/, '');

        return (query.length > 2 ? query + "&" : "?") + (newval ? param + "=" + newval : '');
    }    
    
        function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}    
    
    
    $("#ButtonLanEs").click(function(){

        var str = window.location.search
        str =  window.location.hash.substr(0)
        //alert(str)
        language="ES"
        window.location = "#"+language+"/#page/" + audioNumber+ "/&name="+name;
        //window.location = window.location.pathname + "#"+language+"/#page/" + audioNumber;
        location.reload();
    });
    
    $("#ButtonLanEn").click(function(){

        var str = window.location.search
        str =  window.location.hash.substr(0)
        //alert(str)
        language="EN"
        window.location = "#"+language+"/#page/" + audioNumber+ "/&name="+name;
        //window.location = window.location.pathname + "#"+language+"/#page/" + audioNumber;
        location.reload();
    });
    
    $("#ButtonLanZh").click(function(){

       var str = window.location.search
        str =  window.location.hash.substr(0)
        //alert(str)
        language="ZH"
        window.location = "#"+language+"/#page/" + audioNumber+ "/&name="+name;
        //window.location = window.location.pathname + "#"+language+"/#page/" + audioNumber;
        location.reload();
    });
    
    $("#ButtonLanJa").click(function(){

        var str = window.location.search
        str =  window.location.hash.substr(0)
        //alert(str)
        language="JA"
        window.location = "#"+language+"/#page/" + audioNumber+ "/&name="+name;
        //window.location = window.location.pathname + "#"+language+"/#page/" + audioNumber;
        location.reload();
    });
    
    $("#ButtonLanKo").click(function(){

        var str = window.location.search
        str =  window.location.hash.substr(0)
        //alert(str)
        language="KO"
        window.location = "#"+language+"/#page/" + audioNumber+ "/&name="+name;
        //window.location = window.location.pathname + "#"+language+"/#page/" + audioNumber;
        location.reload();
    });
    
    $("#ButtonLanPt").click(function(){

        var str = window.location.search
        str =  window.location.hash.substr(0)
        //alert(str)
        language="PT"
        window.location = "#"+language+"/#page/" + audioNumber+ "/&name="+name;
        //window.location = window.location.pathname + "#"+language+"/#page/" + audioNumber;
        location.reload();
    });
    
    $(".languageButton").click(function(){
        var idioma = $(".idiomas");
        if (idioma.css("display") === "block") {
            idioma.css("display","none");
        } else {
            idioma.css("display","block");
        }
    
        
    });
    
    //TweenMax.fromTo($("#activeNext"),1,{alpha:0.5},{alpha:1,yoyo:true,repeat:-1});
    

    
    $("#audiosGroup").append('<audio id="audio0" preload="true" src="audios/' +  0 + '.mp3"></audio>') 
    for(var i = 1;i<=6;i++){
       $("#audiosGroup").append('<audio id="audio'+i+'" preload="true" src="audios/' +[language] + "/" +  i + '.mp3"></audio>')  
    }
    
    
function loadApp() {

 	$('#canvas').fadeIn(1000);

 	var flipbook = $('.magazine');

 	// Check if the CSS was already loaded
	
	if (flipbook.width()==0 || flipbook.height()==0) {
		setTimeout(loadApp, 10);
		return;
	}
	
	// Create the flipbook

	flipbook.turn({
			
			// Magazine width

			width: 922,

			// Magazine height

			height: 600,

			// Duration in millisecond

			duration: 1000,

			// Enables gradients

			gradients: true,
			
			// Auto center this flipbook

			autoCenter: true,

			// Elevation from the edge of the flipbook when turning a page

			elevation: 50,

			// The number of pages

			pages: 20,

			// Events

			when: {
                
                
                
				turning: function(event, page, view) {
					
					var book = $(this),
					currentPage = book.turn('page'),
					pages = book.turn('pages');
                    
		

				updateDepth(book, page);
				
				if (page>=2)
					$('.magazine .p2').addClass('fixed');
				else
					$('.magazine .p2').removeClass('fixed');

				if (page<book.turn('pages'))
					$('.magazine .p19').addClass('fixed');
				else
					$('.magazine .p19').removeClass('fixed');

                    if(language == "ES"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2ES.png')");
                }else if(language == "EN"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2EN.png')");
                }else if(language == "ZH"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2ZH.png')");
                }else if(language == "KO"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2KO.png')");
                }else if(language == "JA"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2JA.png')");
                }else if(language == "PT"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2PT.png')");
                }else{
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2EN.png')");
                }
                    
                    if(language == "ES"){
                    $(".magazine").find(".p5").css("background-image","url('bookpages/5ES.png')");
                }else if(language == "EN"){
                    $(".magazine").find(".p5").css("background-image","url('bookpages/5EN.png')");
                }else if(language == "ZH"){
                    $(".magazine").find(".p5").css("background-image","url('bookpages/5ZH.png')");
                }else if(language == "KO"){
                    $(".magazine").find(".p5").css("background-image","url('bookpages/5KO.png')");
                }else if(language == "JA"){
                    $(".magazine").find(".p5").css("background-image","url('bookpages/5JA.png')");
                }else if(language == "PT"){
                    $(".magazine").find(".p5").css("background-image","url('bookpages/5PT.png')");
                }else{
                    $(".magazine").find(".p5").css("background-image","url('bookpages/5EN.png')");
                }
                    
					Hash.go('page/' + page).update();

					// Show and hide navigation buttons
                    audioNumber = page;
					disableControls(page);

				},
                
				turned: function(event, page, view) {
                    
					disableControls(page);
                    var object = $(this);

					$(this).turn('center');
                   

					$('#slider').slider('value', getViewNumber(object, page));
                    audioNumber = page;
            
					if (page==1) { 
						$(this).turn('peel', 'br');
					}

				},

				missing: function (event, pages) {

					// Add pages that aren't in the magazine

					for (var i = 0; i < pages.length; i++)
						addPage(pages[i], $(this));

				}
			}

        
	});

	// Zoom.js

    
    
	$('.magazine-viewport').zoom({
		flipbook: $('.magazine'),

		max: function() { 
			
			return largeMagazineWidth()/$('.magazine').width();

		}, 

		when: {
			swipeLeft: function() {

				$(this).zoom('flipbook').turn('next');
                
                stopAllSounds();

			},

			swipeRight: function() {
				
				$(this).zoom('flipbook').turn('previous');
                stopAllSounds();

			},

			resize: function(event, scale, page, pageElement) {

//				if (scale==1)
//					loadSmallPage(page, pageElement);
//				else
//					loadLargePage(page, pageElement);

			},

			zoomIn: function () {
                
                $(".userName").addClass("zoomUserName")
				$('#slider-bar').hide();
				$('.made').hide();
				$('.magazine').removeClass('animated').addClass('zoom-in');
				$('.zoom-icon').removeClass('zoom-icon-in').addClass('zoom-icon-out');
				
				if (!window.escTip && !$.isTouch) {
					escTip = true;

					$('<div />', {'class': 'exit-message'}).
						html('<div>Press ESC to exit</div>').
							appendTo($('body')).
							delay(2000).
							animate({opacity:0}, 500, function() {
								$(this).remove();
							});
				}
			},

			zoomOut: function () {
                
                $(".userName").removeClass("zoomUserName")
				$('#slider-bar').fadeIn();
				$('.exit-message').hide();
				$('.made').fadeIn();
				$('.zoom-icon').removeClass('zoom-icon-out').addClass('zoom-icon-in');

				setTimeout(function(){
					$('.magazine').addClass('animated').removeClass('zoom-in');
					resizeViewport();
				}, 0);

			}
		}
	});




	// Using arrow keys to turn the page

	$(document).keydown(function(e){

		var previous = 37, next = 39, esc = 27;

		switch (e.keyCode) {
			case previous:

				// left arrow
				$('.magazine').turn('previous');
                stopAllSounds();
				e.preventDefault();

			break;
			case next:

				//right arrow
				$('.magazine').turn('next');
                stopAllSounds();
				e.preventDefault();
                

			break;
			case esc:
				
				$('.magazine-viewport').zoom('zoomOut');	
				e.preventDefault();

			break;
		}
	});

	// URIs - Format #/page/1 

    
    
	Hash.on('^page\/([0-9]*)$', {
		yep: function(path, parts) {
			var page = parts[1];

			if (page!==undefined) {
				if ($('.magazine').turn('is'))
					$('.magazine').turn('page', page);
                audioReady = page;
                
			}

		},
		nop: function(path) {

			if ($('.magazine').turn('is'))
				$('.magazine').turn('page', 1);
		}
	});


	$(window).resize(function() {
		resizeViewport();
	}).bind('orientationchange', function() {
		resizeViewport();
	});

	// Regions

	if ($.isTouch) {
		$('.magazine').bind('touchstart', regionClick);
	} else {
		$('.magazine').click(regionClick);
	}

	// Events for the next button

	$('.next-button').bind($.mouseEvents.over, function() {
		
		$(this).addClass('next-button-hover');

	}).bind($.mouseEvents.out, function() {
		
		$(this).removeClass('next-button-hover');

	}).bind($.mouseEvents.down, function() {
		
		$(this).addClass('next-button-down');

	}).bind($.mouseEvents.up, function() {
		
		$(this).removeClass('next-button-down');

	}).click(function() {
		
		$('.magazine').turn('next');
        stopAllSounds();
        
	});

	// Events for the next button
	
	$('.previous-button').bind($.mouseEvents.over, function() {
		
		$(this).addClass('previous-button-hover');

	}).bind($.mouseEvents.out, function() {
		
		$(this).removeClass('previous-button-hover');

	}).bind($.mouseEvents.down, function() {
		
		$(this).addClass('previous-button-down');

	}).bind($.mouseEvents.up, function() {
		
		$(this).removeClass('previous-button-down');

	}).click(function() {
		
		$('.magazine').turn('previous');
            stopAllSounds();

	});


	// Slider

	$( "#slider" ).slider({
		min: 1,
		max: numberOfViews(flipbook),

		start: function(event, ui) {
			if (!window._thumbPreview) {
				_thumbPreview = $('<div />', {'class': 'thumbnail'}).html('<div></div>');
				//setPreview(ui.value);
				//_thumbPreview.appendTo($(ui.handle));
			} else
				//setPreview(ui.value);

			moveBar(false);

		},

		slide: function(event, ui) {

			//setPreview(ui.value);

		},

		stop: function() {

			if (window._thumbPreview)
				_thumbPreview.removeClass('show');
			     
			$('.magazine').turn('page', Math.max(1, $(this).slider('value')*2 - 2));
            stopAllSounds();
		}
	});

	resizeViewport();

	$('.magazine').addClass('animated');

}

// Zoom icon

 $('.zoom-icon').bind('mouseover', function() { 
 	
 	if ($(this).hasClass('zoom-icon-in'))
 		$(this).addClass('zoom-icon-in-hover');

 	if ($(this).hasClass('zoom-icon-out'))
 		$(this).addClass('zoom-icon-out-hover');
 
 }).bind('mouseout', function() { 
 	
 	 if ($(this).hasClass('zoom-icon-in'))
 		$(this).removeClass('zoom-icon-in-hover');
 	
 	if ($(this).hasClass('zoom-icon-out'))
 		$(this).removeClass('zoom-icon-out-hover');

 }).bind('click', function() {

 	if ($(this).hasClass('zoom-icon-in'))
 		$('.magazine-viewport').zoom('zoomIn');
 	else if ($(this).hasClass('zoom-icon-out'))	
		$('.magazine-viewport').zoom('zoomOut');

 });
      
    
function visibleNext(){
    $("#activeNext").css("display","block")
    
}    
    
    
    function stopAllSounds(){
        
        if(audioNumber >= [allPages-2]){
                mixpanel.track("OnBookFinished",{
                        "user_id": credentials.educationID,
                        "app": "web",
                        "bookID" : "6",
                        "bookName" : "Estoy enojada"
                    });      
        }
        
        
        $("#activeNext").css("display","none");
        $(".buttonSound").css("opacity",1);
        playing = false;
        audiosNumbers();
        audioPlayer = document.getElementById("audio" +  audioReady);
        audioPlayer.currentTime = 0;
        
          for(i= 0; i<=6;i++){
                    var audio = document.getElementById("audio" + i);
                        audio.pause();
                        audio.currentTime = 0;
                    
                } 
        
        AudioPlay();
        
    }    

    
function audiosNumbers(){
               
            switch(audioNumber){
                case 1:
                    audioReady = 0
                   break;
                case 2:
                    audioReady = 0
                   break;
                case 3:
                    audioReady = 0
                   break;
                case 4:
                    audioReady = 0
                   break;
                case 5:
                    audioReady = 0
                   break;
                case 6:
                    audioReady = 1
                   break;
                case 7:
                    audioReady = 1
                   break;
                case 8:
                    audioReady = 2
                   break;
                case 9:
                    audioReady = 2
                   break;
                case 10:
                    audioReady = 3
                   break;
                case 11:
                    audioReady = 3
                   break;
                case 12:
                    audioReady = 4
                   break;
                case 13:
                    audioReady = 4
                   break;
                case 14:
                    audioReady = 5
                   break;
                case 15:
                    audioReady = 5
                   break;
                 case 16:    
                    audioReady = 6
                    break;
                 case 17:    
                    audioReady = 6
                    break;
                 case 18:    
                    audioReady = 0
                    break;
                case 19:    
                    audioReady = 0
                    break;
                case 20:    
                    audioReady = 0
                    break;
            }
}    

    
function AudioPlay(){
   if(!playing) {
       autoPlay();
       audioPlayer.currentTime = 0;
      
   }else{
       
            if (audioPlayer.paused) {
                audioPlayer.play();
                $(".buttonSound").css("opacity",1);
                } else {
                    audioPlayer.pause();
                                $(".buttonSound").css("opacity",0.5);    
                }
       if(language == "ES"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaES" + audioReady)); 
        }else if(language == "EN"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaEN" + audioReady));
        }else if(language == "KO"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaKO" + audioReady));
        }   
       
       
   }    
    
};

function autoPlay(){
    audiosNumbers();

    console.log("audioReady: " + audioReady);
    audioPlayer = document.getElementById("audio" +  audioReady); 
        audioPlayer.play();
        if(language == "ES"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaES" + audioReady)); 
        }else if(language == "EN"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaEN" + audioReady));
        }else if(language == "KO"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaKO" + audioReady));
        }        
        audioPlayer.addEventListener("timeupdate", function(e){
            playing = true;
        });

}          
    
 $('#canvas').hide();


yepnope({
	test : Modernizr.csstransforms,
	yep: ['lib/turn.js'],
	nope: ['lib/turn.html4.min.js', 'css/jquery.ui.html4.css'],
	both: ['lib/zoom.min.js', 'css/jquery.ui.css', 'js/magazine.js', 'css/magazine.css','css/custom_fonts.css'],
	complete: loadApp
});

var credentials = epicModel.getCredentials();    
    
$(document).ready(function () {
    /**
     * * Metodo implementado en mixpanel.js
     */
    var credentials1 = epicModel.getCredentials();   

    mixpanel.track(
        "OnBookOpen",
        {
            "user_id": credentials1.educationID,
            "app": "web",
            "bookID" : "13",
            "bookName" : "El espacio ideal"
        }
    );
    
    

    
});    
    
    
var allPages =  20    


function mixPanelClose(){
        mixpanel.track(
            "OnBookClose", 
            {
                "user_id": credentials.educationID,
                "app": "web",
                "bookID" : "13",
                "bookName" : "El espacio ideal",
                "lastPage" : audioNumber    
            }
        );
}   
    

    function stopAllSounds(){
        if(audioNumber >= [allPages-2]){
                mixpanel.track("OnBookFinished",{
                        "user_id": credentials.educationID,
                        "app": "web",
                        "bookID" : "13",
                        "bookName" : "El espacio ideal"
                    });      
        }
        
        
        $("#activeNext").css("display","none");
        playing = false;
        audiosNumbers();
       audioPlayer = document.getElementById("audio" +  audioReady);
        $("#buttonPlay").attr("src","images/Play.png");
          for(i= 0; i<=6;i++){
                    var audio = document.getElementById("audio" + i);
                        audio.pause();
                        audio.currentTime = 0;
                    
                } 
        
    }    
    
    var leaving = true;
    var isClose = false;

    function EndChatSession() {
        var request = GetRequest();
        request.open("GET", "../Chat.aspx", true);
        request.send();
    }
    document.onkeydown = checkKeycode
    function checkKeycode(e) {
        var keycode;
        if (window.event)
            keycode = window.event.keyCode;
        else if (e)
            keycode = e.which;
        if (keycode == 116) {
            isClose = true;
        }
    }
    function somefunction() {
        isClose = true;
    }
    
    window.onbeforeunload = function (e) {
       if (!e) e = event;
        if (leaving) {
             EndChatSession();
             mixPanelClose();
             //e.returnValue = "Are You Sure";

        }
    }
    function GetRequest() {
        var xmlHttp = null;
        try {
            // Firefox, Opera 8.0+, Safari
            xmlHttp = new XMLHttpRequest();
        }
        catch (e) {
            //Internet Explorer
            try {
                xmlHttp = new ActiveXObject("Msxml2.XMLHTTP");
            }
            catch (e) {
                xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
        }
        return xmlHttp;
    }       
</script>
</body>
</html>
