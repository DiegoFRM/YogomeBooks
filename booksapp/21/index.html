<!doctype html>
<html>
<head>
<title class="languageTitle">El río</title>
 <meta charset="UTF-8">    
<meta name="viewport" content="width = 1050, user-scalable = no" />
<link rel="icon" type="image/png" href="../../pics/favicon.png" />
<script type="text/javascript" src="extras/jquery.min.1.7.js"></script>
<script type="text/javascript" src="extras/jquery-ui-1.8.20.custom.min.js"></script>
<script type="text/javascript" src="extras/modernizr.2.5.3.min.js"></script>
<script type="text/javascript" src="lib/hash.js"></script>
<script type="text/javascript" src="js/jquery.blast.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js"></script>
    <script type="text/javascript" src="js/tracks.js"></script>
<script type="text/javascript" src="js/audioSync.js"></script>  
    <!--ESta de manera absoluta la direccion de epic model, por la profundidad que tiene dentro del server-->
<script type="text/javascript" src="http://play.yogome.com/js/epic/models/epicModel.js"></script>    
<script type="text/javascript" src="../../js/mixpanel/mixpanel.js"></script>        
    <script>
        var meta = document.createElement('meta');
        meta.setAttribute("property","og:description");
        
    </script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta property="og:url"				content="https://play.yogome.com/yogomebooks/21/#EN"/>
    <meta property="og:type"			content="article" />
    <meta property="og:title"			content="Interactive Book: The River " />
    <meta property="og:image"			content="https://play.yogome.com/yogomebooks/posts/fbpost_21.png" />
    
<script>
    var languageTitles = [
            {
                ES:"El río",
                EN:"The River",
                PT:"O rio",
                ZH:"河流",
                JA:"川",
                KO:"강 건너기"
            }
        ]
    
    //AQUI VA PARA SABER EL LENGUAGE
        function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}

        var language

      var  str =window.location.hash;
        var array=str.split("/")
        language=array[0].substr(1)
        console.log(language)
    
    function changeTitle(){
        if(language == "ES"){
            $(".languageTitle").text(languageTitles[0][language])
        }else if(language == "EN"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else if(language == "PT"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else if(language == "ZH"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else if(language == "JA"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else if(language == "KO"){
            $(".languageTitle").text(languageTitles[0][language])    
        }else{
            $(".languageTitle").text(languageTitles[0].EN)    
        }
    }    
    
    changeTitle()
    
var languagePages = [
                {
                    page:1,
                    ES:"Nao y Tomiko estaban en una carrera de parejas.</br> El camino había estado lleno de obstáculos. </br> Pero a pocos metros de llegar a la meta se encontraron con un río, uno de los mayores obstáculos hasta el momento.",
                    EN:"Nao and Tomiko were competing in a two-person race.</br> The road was full of obstacles </br> but just a few meters away from the finish line they found a river. The biggest obstacle of all.",
                    KO:"나오와 토미코, 두 요고타는 두 명이 팀으로 참가하는 경주에서 뛰고 있었어요. 달리는 도로 위에는 장애물이 아주 많이 있었지만 결승선까지는 몇 미터 남지 않았었어요. 그리고 그 둘은 강이라는 가장 큰 장애물을 보게 되었어요.",
                    ZH:"奈绪和富子参加了一场两人比赛。路上设置了各种障碍物，但在离终点线只有几米远的地方，他们发现了一条河。这是所有障碍中最大的障碍。",
                    JA:"ナオとトミコのふたりぐみはレースにさんかしていました。とちゅうにはゆくてをはばむものでいっぱいでしたが、あとすこしでゴールというところに川がありました。これまででいちばんおおきなしょうがいです。",
                    PT:"Nao e Tomiko estavam competindo em uma corrida em duplas. A estrada estava cheia de obstáculos, mas a apenas alguns metros da linha de chegada eles encontraram um rio. O maior obstáculo de todos."
                },
                {
                    page:2,
                    ES:"Nao se detuvo a observar lo que se encontraba frente a él </br> y Tomiko empezó a desesperarse. </br> -¡Corre! No te detengas -dijo.</br> -Espera, es mejor pensar antes de actuar -dijo Nao tranquilamente.</br> -Nos van a ganar -Tomiko gritó.",
                    EN:"Nao stopped and stared.</br> Tomiko became desperate.</br> “Run! Don't stop” she said.</br> “Wait, it's better to think before you act,” said Nao calmly.</br> “We are going to lose!” shouted Tomiko.",
                    KO:'나오는 멈춰서서 강을 바라보았어요. 토미코는 마음이 조급해졌어요. "뛰어! 멈추지 마," 토미코가 말했어요. "기다려 봐, 무작정 뛰기 전에 무엇을 할지 미리 생각해보자." 나오가 아주 침착하게 말했어요. "우리는 이러다 질거야" 토미코가 소리쳤어요.',
                    ZH:"奈绪停下来，目不转睛地观察着。富子都要绝望了。“快跑！不要停下来。”她说。“等等，在你行动之前最好思考一下。”奈绪平静地说。“我们要输了！”富子喊道。",
                    JA:"ナオは立ちどまって川をみつめました。トミコはひっしです。「はしろう！とまらないで！」トミコはいいました。「まって、よくかんがえてからこうどうしたほうがいいよ」ナオはおちついていいました。「わたしたちまけてしまうわ」トミコがさけびました。",
                    PT:"Nao parou e ficou olhando. Tomiko entrou em desespero. “Corra! Não pare”, disse ela. “Espere, é melhor pensar antes de agir”, disse Nao calmamente. “A gente vai perder”, gritou Tomiko."
                },
                {
                    page:3,
                    ES:"Nao no contestó siguió observando el río  con detenimiento. Buscaba una manera para pasar sobre él de la mejor forma.",
                    EN:"Nao didn't answer. He kept staring at the river, He was looking for the best way to cross over it.",
                    KO:"나오는 대답하지 않고 대신 강을 계속 쳐다보고 있었어요. 나오는 강을 건너갈 가장 좋은 방법을 찾고 있었어요.",
                    ZH:"奈绪没有回答。他一直盯着那条河。他正在思索过河的最佳方法。",
                    JA:"ナオはこたえません。川をじっとみつめています。川をわたるにはどうすればよいかかんがえているのです。",
                    PT:"Nao não respondeu nada. Ele continuou olhando para o rio. Estava procurando o melhor jeito de atravessá-lo."
                },
                {
                    page:4,
                    ES:"-Yo me voy- dijo Tomiko</br> y corrió hasta perderse en el horizonte; Nao siguió observando.",
                    EN:"“I'm leaving,” said Tomiko</br> as she ran until disappearing into the horizon. Nao kept looking.",
                    KO:'"나는 지금 갈거야" 토미고가 얘기했어요. 토미코는 뛰어갔고 곧 수평선 저 너머로 사라졌어요. 나오는 계속 강을 보기만 하고 있었어요.',
                    ZH:"“我要走了。”富子边跑边说，直到消失在地平线上。奈绪一直盯着看。",
                    JA:"「わたしもういくわ」トミコはそういってみえなくなるまではしっていきました。ナオはみつめつづけています。",
                    PT:"“Eu vou embora”, disse Tomiko enquanto corria até desaparecer no horizonte. Nao continuou olhando."
                },
                {
                    page:5,
                    ES:"Tomiko estaba muy cansada, el agua del río hacía pesados sus pasos, no sólo los de ella, también los del resto de los competidores. </br> Después de varios minutos sintió que algo la jalaba... era la mano de Nao, ayudándola a subir a una roca.",
                    EN:"Tomiko was really tired and the river made her steps heavy. </br>   After several minutes, she felt someone pull her out. It was Nao's hand helping her from the top of a rock.",
                    KO:"토미코는 너무 지쳤고 강물을 가로지르면서 뛰는건 어려웠어요.   몇 분 후에 토미코는 넘어졌고, 그 순간 누군가 토미코를 구해줬어요. 토미코를 강물에서 꺼내준 건 나오의 손이었어요. 나오는 바위 위에서 토미코를 구해줬어요.",
                    ZH:"富子真的很累，河水使她步履沉重   几分钟后，她感觉有人把她拉了出来。原来是奈绪站在石头上伸出手来帮助她。",
                    JA:"トミコはとてもつかれてしまいました。みずのなかではあしがおもくなります。  なんふんかたったあと、だれかがトミコをひっぱりあげるのにきづきました。それはナオの手でした。石のうえからたすけようとしているのです。",
                    PT:"Tomiko estava muito cansada, e o rio deixava seus pés pesados.    Depois de alguns minutos, ela sentiu alguém puxá-la. Era a mão de Nao ajudando-a de cima de uma pedra."
                },
                {
                    page:6,
                    ES:"-¡Ganamos! ¿Cómo lograste llegar hasta donde me encontraba?-<br> -Fácil, el río estaba lleno de grandes rocas y salté sobre cada una en vez de caminar por el agua- respondió Nao con tranquilidad.<br> -Pero… ¿Cómo lo supiste? -dijo Tomiko, algo sorprendida.<br> -Antes de actuar debemos ser pacientes, lo importante no es ganar, sino llegar.",
                    EN:"“We won! How did you get to me?”</br>  “Easy! The river was filled with big rocks and I jumped over them instead of walking through water,” answered Nao.</br> “But... How did you figure that out?” said Tomiko surprised.</br> “We must be patient before we act. The most important thing is to get to your destination safely, not win.”",
                    KO:'"우리가 이겼어! 어떻게 나를 구해준거니?" "간단해! 강에는 큰 바위가 많이 있었어. 난 그래서 강을 뛰어서 건너가지 않고 바위 위를 징검다리처럼 건너서 왔어. "나오가 대답했어요. "너는… 어떻게 그걸 알아낸거니? "토미코가 놀라서 물었어요. "우리는 무엇을 할지 충분히 생각하고 행동해야해. 이기는 게 중요한 게 아니라 어떻게 결승선까지 안전하게 가는지가 중요한거야."',
                    ZH:"“我们赢了！你是怎么追上我的？”“很简单！河里有很多的大石头，我踩在石头上跳过去，而不是在水里行走。”奈绪回答。“可是...你怎么知道的？”富子惊讶的说。“我们在行动之前必须有耐心。最重要的是安全到达目的地，而不是获胜。",
                    JA:"「ぼくたちかったよ！どうやってここまできたの？」「かんたんさ！川には大きな石がたくさんあるから、みずのなかをあるくかわりに石のうえをジャンプしてきたんだ」ナオはこたえました。「でも...どうしてわかったの？」トミコがおどろいてたずねました。「なにかをするまえにはあせらずがまんしなくちゃ。いちばんだいじなことはかつことではなく、あんぜんにたどりつくことさ。",
                    PT:"“Nós vencemos! Como você me alcançou?” “Foi fácil! O rio estava cheio de pedras grandes, e eu pulei nelas em vez de atravessar pela água”, respondeu Nao. “Mas... Como você teve essa ideia?”, disse Tomiko, surpresa. “Devemos ter paciência antes de agir. A coisa mais importante é chegar ao destino em segurança, não vencer."
                }
                ]    
    
    
    </script>   
</head>
<body>

<div id="canvas">


<div class="magazine-viewport">
	<div class="container">
        
		<div class="magazine">
            <!--  BOTON SIGUIENTE      -->
                <div ignore="1" class="next-button">
                    <div id="activeNext" >
                        <div class="animation1"> 
                        </div>
                    </div>
                    <img src="images/nextButton.png">
                </div>
            <!-- Previous button -->
			<div ignore="1" class="previous-button">
    <img src="images/nextButton.png">
            </div> 
            <div id="p1" depth="5" class="hard"> <div class="side"></div> </div>
			<div depth="5" class="hard front-side"> <div class="depth"></div> </div>
			<div class="hard fixed back-side p17"></div>
			<div class="hard p18"></div>

            </div>
            <script>
                //console.log(languagePages[0][language]);
                if(language == "ES"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1ES.png')");
                }else if(language == "EN"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1EN.png')");
                }else if(language == "ZH"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1ZH.png')");
                }else if(language == "KO"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1KO.png')");
                }else if(language == "JA"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1JA.png')");
                }else if(language == "PT"){
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1PT.png')");
                }else{
                    $(".magazine").find("#p1").css("background-image","url('bookpages/1EN.png')");
                }
            
            </script>
        
        
			<!-- Next button -->
		</div>
	</div>
   <a onclick="goBack()"><div id="homeButton"><img src="images/homeButton.png" /></div></a>

<script>
function goBack() {
    window.location.href="../../books.html?cachebust=“..randomNumber..“&language=“..localization.getLanguage()..“&email=“..email..“&name="+name+"&remoteid=“..remoteID..“&educationid=“..educationID..“&age=“..age..“&app=true”";
}
</script>
    <div class="languageButton"><img src="images/icon-languages.png"></div>
    <div class="idiomas">
        <div id="ButtonLanEs" class="overLanguage">Español</div>
        <div id="ButtonLanEn" class="overLanguage">English</div>
        <div id="ButtonLanZh" class="overLanguage">中國</div>
        <div id="ButtonLanJa" class="overLanguage">日本語</div>
        <div id="ButtonLanKo" class="overLanguage">한국어</div>
        <div id="ButtonLanPt" class="overLanguage">PORTUGUES</div>
    </div>
    <div id="audiosGroup"></div>
	<div class="bottom">
       
		<div id="slider-bar" class="turnjs-slider timeline-style">
			<div id="slider">
            </div>
		</div>
	</div>
    
</div>

<script type="text/javascript">
    //$("#sectionPlayButton").hide();
    var audioNumber;
    var clearTimeOut;
    var audioReady;
    var playing = false;
    var audioPlayer; 
    //cambio de regex
    function replaceQueryParam(param, newval, search) {
        var regex = new RegExp("([?;&])" + param + "[^&;]*[;&]?");
        var query = search.replace(regex, "$1").replace(/&$/, '');

        return (query.length > 2 ? query + "&" : "?") + (newval ? param + "=" + newval : '');
    }    
    
    
    $("#ButtonLanEs").click(function(){

        var str = window.location.search
        str =  window.location.hash.substr(0)
        //alert(str)
        language="ES"
        window.location = "#"+language+"/#page/" + audioNumber+ "/&name="+name;
        //window.location = window.location.pathname + "#"+language+"/#page/" + audioNumber;
        location.reload();
    });
    
    $("#ButtonLanEn").click(function(){

        var str = window.location.search
        str =  window.location.hash.substr(0)
        //alert(str)
        language="EN"
        window.location = "#"+language+"/#page/" + audioNumber+ "/&name="+name;
        //window.location = window.location.pathname + "#"+language+"/#page/" + audioNumber;
        location.reload();
    });
    
    $("#ButtonLanZh").click(function(){

       var str = window.location.search
        str =  window.location.hash.substr(0)
        //alert(str)
        language="ZH"
        window.location = "#"+language+"/#page/" + audioNumber+ "/&name="+name;
        //window.location = window.location.pathname + "#"+language+"/#page/" + audioNumber;
        location.reload();
    });
    
    $("#ButtonLanJa").click(function(){

        var str = window.location.search
        str =  window.location.hash.substr(0)
        //alert(str)
        language="JA"
        window.location = "#"+language+"/#page/" + audioNumber+ "/&name="+name;
        //window.location = window.location.pathname + "#"+language+"/#page/" + audioNumber;
        location.reload();
    });
    
    $("#ButtonLanKo").click(function(){

        var str = window.location.search
        str =  window.location.hash.substr(0)
        //alert(str)
        language="KO"
        window.location = "#"+language+"/#page/" + audioNumber+ "/&name="+name;
        //window.location = window.location.pathname + "#"+language+"/#page/" + audioNumber;
        location.reload();
    });
    
    $("#ButtonLanPt").click(function(){

        var str = window.location.search
        str =  window.location.hash.substr(0)
        //alert(str)
        language="PT"
        window.location = "#"+language+"/#page/" + audioNumber+ "/&name="+name;
        //window.location = window.location.pathname + "#"+language+"/#page/" + audioNumber;
        location.reload();
    });
    
    $(".languageButton").click(function(){
        var idioma = $(".idiomas");
        if (idioma.css("display") === "block") {
            idioma.css("display","none");
        } else {
            idioma.css("display","block");
        }
    
        
    });
    
    TweenMax.fromTo($("#activeNext"),1,{alpha:0.5},{alpha:1,yoyo:true,repeat:-1});
    
    $("#audiosGroup").append('<audio id="audio0" preload="true" src="audios/' +  0 + '.mp3"></audio>') 
    for(var i = 1;i<=6;i++){
       $("#audiosGroup").append('<audio id="audio'+i+'" preload="true" src="audios/' +[language] + "/" +  i + '.mp3"></audio>')  
    }
    

function loadApp() {

 	$('#canvas').fadeIn(1000);

 	var flipbook = $('.magazine');

 	// Check if the CSS was already loaded
	
	if (flipbook.width()==0 || flipbook.height()==0) {
		setTimeout(loadApp, 10);
		return;
	}
	
	// Create the flipbook

	flipbook.turn({
			
			// Magazine width

			width: 922,

			// Magazine height

			height: 600,

			// Duration in millisecond

			duration: 1000,

			// Enables gradients

			gradients: true,
			
			// Auto center this flipbook

			autoCenter: true,

			// Elevation from the edge of the flipbook when turning a page

			elevation: 50,

			// The number of pages

			pages: 18,

			// Events

			when: {
                
                
                
				turning: function(event, page, view) {
					
					var book = $(this),
					currentPage = book.turn('page'),
					pages = book.turn('pages');
                    
		

				updateDepth(book, page);
				
				if (page>=2)
					$('.magazine .p2').addClass('fixed');
				else
					$('.magazine .p2').removeClass('fixed');

				if (page<book.turn('pages'))
					$('.magazine .p17').addClass('fixed');
				else
					$('.magazine .p17').removeClass('fixed');
                    
                    
                    if(language == "ES"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2ES.png')");
                }else if(language == "EN"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2EN.png')");
                }else if(language == "ZH"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2ZH.png')");
                }else if(language == "KO"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2KO.png')");
                }else if(language == "JA"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2JA.png')");
                }else if(language == "PT"){
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2PT.png')");
                }else{
                    $(".magazine").find(".p2").css("background-image","url('bookpages/2EN.png')");
                }


					Hash.go(language +'/page/' + page).update();

					// Show and hide navigation buttons
                    audioNumber = page;
					disableControls(page);

				},
                
                
                
				turned: function(event, page, view) {

					disableControls(page);
                    var object = $(this);

					$(this).turn('center');
                   

					$('#slider').slider('value', getViewNumber(object, page));
                    audioNumber = page;
            
					if (page==1) { 
						$(this).turn('peel', 'br');
					}

				},

				missing: function (event, pages) {

					// Add pages that aren't in the magazine

					for (var i = 0; i < pages.length; i++)
						addPage(pages[i], $(this));

				}
			}

        
	});

	// Zoom.js


    
	$('.magazine-viewport').zoom({
		flipbook: $('.magazine'),

		max: function() { 
			
			return largeMagazineWidth()/$('.magazine').width();

		}, 

		when: {
			swipeLeft: function() {

				$(this).zoom('flipbook').turn('next');
                
                stopAllSounds();

			},

			swipeRight: function() {
				
				$(this).zoom('flipbook').turn('previous');
                stopAllSounds();

			},

			resize: function(event, scale, page, pageElement) {

//				if (scale==1)
//					loadSmallPage(page, pageElement);
//				else
//					loadLargePage(page, pageElement);

			},

			zoomIn: function () {
                
                $(".userName").addClass("zoomUserName")
				$('#slider-bar').hide();
				$('.made').hide();
				$('.magazine').removeClass('animated').addClass('zoom-in');
				$('.zoom-icon').removeClass('zoom-icon-in').addClass('zoom-icon-out');
				
				if (!window.escTip && !$.isTouch) {
					escTip = true;

					$('<div />', {'class': 'exit-message'}).
						html('<div>Press ESC to exit</div>').
							appendTo($('body')).
							delay(2000).
							animate({opacity:0}, 500, function() {
								$(this).remove();
							});
				}
			},

			zoomOut: function () {
                $(".userName").removeClass("zoomUserName")
				$('#slider-bar').fadeIn();
				$('.exit-message').hide();
				$('.made').fadeIn();
				$('.zoom-icon').removeClass('zoom-icon-out').addClass('zoom-icon-in');

				setTimeout(function(){
					$('.magazine').addClass('animated').removeClass('zoom-in');
					resizeViewport();
				}, 0);

			}
		}
	});

	// Zoom event



	// Using arrow keys to turn the page

	$(document).keydown(function(e){

		var previous = 37, next = 39, esc = 27;

		switch (e.keyCode) {
			case previous:

				// left arrow
				$('.magazine').turn('previous');
                stopAllSounds();
                
				e.preventDefault();

			break;
			case next:

				//right arrow
				$('.magazine').turn('next');
                stopAllSounds();
				e.preventDefault();

			break;
			case esc:
				
				$('.magazine-viewport').zoom('zoomOut');	
				e.preventDefault();

			break;
		}
	});

	// URIs - Format #/page/1 

    
    
	Hash.on('^page\/([0-9]*)$', {
		yep: function(path, parts) {
			var page = parts[1];

			if (page!==undefined) {
				if ($('.magazine').turn('is'))
					$('.magazine').turn('page', page);
                audioReady = page;
                
			}

		},
		nop: function(path) {

			if ($('.magazine').turn('is'))
				$('.magazine').turn('page', 1);
		}
	});


	$(window).resize(function() {
		resizeViewport();
	}).bind('orientationchange', function() {
		resizeViewport();
	});

	// Regions

	if ($.isTouch) {
		$('.magazine').bind('touchstart', regionClick);
	} else {
		$('.magazine').click(regionClick);
	}

	// Events for the next button

	$('.next-button').bind($.mouseEvents.over, function() {
		
		$(this).addClass('next-button-hover');

	}).bind($.mouseEvents.out, function() {
		
		$(this).removeClass('next-button-hover');

	}).bind($.mouseEvents.down, function() {
		
		$(this).addClass('next-button-down');

	}).bind($.mouseEvents.up, function() {
		
		$(this).removeClass('next-button-down');

	}).click(function() {
		
		$('.magazine').turn('next');
        stopAllSounds();
        
	});

	// Events for the next button
	
	$('.previous-button').bind($.mouseEvents.over, function() {
		
		$(this).addClass('previous-button-hover');

	}).bind($.mouseEvents.out, function() {
		
		$(this).removeClass('previous-button-hover');

	}).bind($.mouseEvents.down, function() {
		
		$(this).addClass('previous-button-down');

	}).bind($.mouseEvents.up, function() {
		
		$(this).removeClass('previous-button-down');

	}).click(function() {
		
		$('.magazine').turn('previous');
            stopAllSounds();

	});


	// Slider

	$( "#slider" ).slider({
		min: 1,
		max: numberOfViews(flipbook),
/*
		start: function(event, ui) {

			if (!window._thumbPreview) {
				_thumbPreview = $('<div />', {'class': 'thumbnail'}).html('<div></div>');
				setPreview(ui.value);
				_thumbPreview.appendTo($(ui.handle));
			} else
				setPreview(ui.value);

			moveBar(false);

		},
*/
		slide: function(event, ui) {

			setPreview(ui.value);

		},

		stop: function() {

			if (window._thumbPreview)
				_thumbPreview.removeClass('show');
			
			$('.magazine').turn('page', Math.max(1, $(this).slider('value')*2 - 2));

		}
	});

	resizeViewport();

	$('.magazine').addClass('animated');

}

// Zoom icon

 $('.zoom-icon').bind('mouseover', function() { 
 	
 	if ($(this).hasClass('zoom-icon-in'))
 		$(this).addClass('zoom-icon-in-hover');

 	if ($(this).hasClass('zoom-icon-out'))
 		$(this).addClass('zoom-icon-out-hover');
 
 }).bind('mouseout', function() { 
 	
 	 if ($(this).hasClass('zoom-icon-in'))
 		$(this).removeClass('zoom-icon-in-hover');
 	
 	if ($(this).hasClass('zoom-icon-out'))
 		$(this).removeClass('zoom-icon-out-hover');

 }).bind('click', function() {

 	if ($(this).hasClass('zoom-icon-in'))
 		$('.magazine-viewport').zoom('zoomIn');
 	else if ($(this).hasClass('zoom-icon-out'))	
		$('.magazine-viewport').zoom('zoomOut');

 });
      
    
function visibleNext(){
    $("#activeNext").css("display","block")
}    
    
    
    function stopAllSounds(){
        
        
        //setTimeout(function(){ AudioPlay(); }, 1000);
        console.log("currentPage: " + audioNumber);
        if(audioNumber >= [allPages-2]){
                mixpanel.track("OnBookFinished",{
                        "user_id": credentials.educationID,
                        "app": "web",
                        "bookID" : "6",
                        "bookName" : "Estoy enojada"
                    });      
        }
        
        
        $("#activeNext").css("display","none");
        $(".buttonSound").css("opacity",1);
        playing = false;
        audiosNumbers();
        audioPlayer = document.getElementById("audio" +  audioReady);
        audioPlayer.currentTime = 0;
          for(i= 0; i<=6;i++){
                    var audio = document.getElementById("audio" + i);
                        audio.pause();
                        audio.currentTime = 0;
                    
                } 
        
        AudioPlay();
        
    }   

 function audiosNumbers(){
               
            switch(audioNumber){
                case 1:
                    audioReady = 0
                   break;
                case 2:
                    audioReady = 0
                   break;
                case 3:
                    audioReady = 0
                   break;
                case 4:
                    audioReady = 1
                   break;
                case 5:
                    audioReady = 1
                   break;
                case 6:
                    audioReady = 2
                   break;
                case 7:
                    audioReady = 2
                   break;
                case 8:
                    audioReady = 3
                   break;
                case 9:
                    audioReady = 3
                   break;
                case 10:
                    audioReady = 4
                   break;
                case 11:
                    audioReady = 4
                   break;
                case 12:
                    audioReady = 5
                   break;
                case 13:
                    audioReady = 5
                   break;
                case 14:
                    audioReady = 6
                   break;
                case 15:
                    audioReady = 6
                   break;
                 case 16:    
                    audioReady = 0
                    break;
                 case 17:    
                    audioReady = 0
                    break;
                 case 18:    
                    audioReady = 0
                    break;
            }
}    

    

    
    
function AudioPlay(){
   if(!playing) {
       autoPlay();
       audioPlayer.currentTime = 0;
      
   }else{
       
            if (audioPlayer.paused) {
                audioPlayer.play();
                $(".buttonSound").css("opacity",1);
                } else {
                    audioPlayer.pause();
                                $(".buttonSound").css("opacity",0.5);    
                }
       if(language == "ES"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaES" + audioReady)); 
        }else if(language == "EN"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaEN" + audioReady));
        }else if(language == "KO"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaKO" + audioReady));
        }   
       
       
   }    
    
};

function autoPlay(){
    audiosNumbers();

    console.log("audioReady: " + audioReady);
    audioPlayer = document.getElementById("audio" +  audioReady); 
        audioPlayer.play();
        if(language == "ES"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaES" + audioReady)); 
        }else if(language == "EN"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaEN" + audioReady));
        }else if(language == "KO"){
            audioSync("texto" + audioReady,"audio" + audioReady,eval("pistaKO" + audioReady));
        }        
        audioPlayer.addEventListener("timeupdate", function(e){
            playing = true;
        });

}       
    
 $('#canvas').hide();


yepnope({
	test : Modernizr.csstransforms,
	yep: ['lib/turn.js'],
	nope: ['lib/turn.html4.min.js', 'css/jquery.ui.html4.css'],
	both: ['lib/zoom.min.js', 'css/jquery.ui.css', 'js/magazine.js', 'css/magazine.css','css/custom_fonts.css'],
	complete: loadApp
});
    
/*MIX PANEL*/
var credentials = epicModel.getCredentials();    
var allPages =  20    
    
    
$(document).ready(function () {
    /**
     * * Metodo implementado en mixpanel.js
     */
    var credentials1 = epicModel.getCredentials();   

    mixpanel.track(
        "OnBookOpen",
        {
            "user_id": credentials1.educationID,
            "app": "web",
            "bookID" : "21",
            "bookName" : "El río"
        }
    );
    
    

    
});    

function mixPanelClose(){
        mixpanel.track(
            "OnBookClose", 
            {
                "user_id": credentials.educationID,
                "app": "web",
                "bookID" : "21",
                "bookName" : "El río",
                "lastPage" : audioNumber
            }
        );
}   
    

    function stopAllSounds(){
        if(audioNumber >= [allPages-2]){
                mixpanel.track("OnBookFinished",{
                        "user_id": credentials.educationID,
                        "app": "web",
                        "bookID" : "21",
                        "bookName" : "El río"
                    });      
        }
        
        
        $("#activeNext").css("display","none");
        playing = false;
        audiosNumbers();
       audioPlayer = document.getElementById("audio" +  audioReady);
        $("#buttonPlay").attr("src","images/Play.png");
          for(i= 0; i<=6;i++){
                    var audio = document.getElementById("audio" + i);
                        audio.pause();
                        audio.currentTime = 0;
                    
                } 
        
    }    
    
    var leaving = true;
    var isClose = false;

    function EndChatSession() {
        var request = GetRequest();
        request.open("GET", "../Chat.aspx", true);
        request.send();
    }
    document.onkeydown = checkKeycode
    function checkKeycode(e) {
        var keycode;
        if (window.event)
            keycode = window.event.keyCode;
        else if (e)
            keycode = e.which;
        if (keycode == 116) {
            isClose = true;
        }
    }
    function somefunction() {
        isClose = true;
    }
    
    window.onbeforeunload = function (e) {
       if (!e) e = event;
        if (leaving) {
             EndChatSession();
             mixPanelClose();
             //e.returnValue = "Are You Sure";

        }
    }
    function GetRequest() {
        var xmlHttp = null;
        try {
            // Firefox, Opera 8.0+, Safari
            xmlHttp = new XMLHttpRequest();
        }
        catch (e) {
            //Internet Explorer
            try {
                xmlHttp = new ActiveXObject("Msxml2.XMLHTTP");
            }
            catch (e) {
                xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
        }
        return xmlHttp;
    }     
        

</script>
</body>
</html>
